

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pydna.dsdna &mdash; Pydna 0.6.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Pydna 0.6.2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pydna 0.6.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pydna.dsdna</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright 2013 by Bj√∂rn Johansson.  All rights reserved.</span>
<span class="c"># This code is part of the Python-dna distribution and governed by its</span>
<span class="c"># license.  Please see the LICENSE.txt file that should have been included</span>
<span class="c"># as part of this package.</span>

<span class="sd">&#39;&#39;&#39;Provides two classes, Dseq and Dseqrecord, for handling double stranded</span>
<span class="sd">DNA sequences. Dseq and Dseqrecord are subclasses of Biopythons</span>
<span class="sd">Seq and SeqRecord classes, respectively. These classes support the</span>
<span class="sd">notion of circular and linear DNA.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">Bio</span>                    <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="kn">from</span> <span class="nn">Bio.Alphabet.IUPAC</span>     <span class="kn">import</span> <span class="n">IUPACAmbiguousDNA</span>
<span class="kn">from</span> <span class="nn">Bio.Seq</span>                <span class="kn">import</span> <span class="n">Seq</span>
<span class="kn">from</span> <span class="nn">Bio.Seq</span>                <span class="kn">import</span> <span class="n">_maketrans</span>
<span class="kn">from</span> <span class="nn">Bio.Data.IUPACData</span>     <span class="kn">import</span> <span class="n">ambiguous_dna_complement</span> <span class="k">as</span> <span class="n">amb_compl</span>
<span class="kn">from</span> <span class="nn">Bio.SeqRecord</span>          <span class="kn">import</span> <span class="n">SeqRecord</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span>         <span class="kn">import</span> <span class="n">SeqFeature</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span>         <span class="kn">import</span> <span class="n">FeatureLocation</span><span class="p">,</span> <span class="n">CompoundLocation</span>
<span class="kn">from</span> <span class="nn">Bio.SeqUtils.CheckSum</span>  <span class="kn">import</span> <span class="n">seguid</span>
<span class="kn">from</span> <span class="nn">Bio.GenBank</span>            <span class="kn">import</span> <span class="n">RecordParser</span>
<span class="kn">from</span> <span class="nn">Bio.Data.CodonTable</span>    <span class="kn">import</span> <span class="n">TranslationError</span>

<span class="kn">from</span> <span class="nn">pydna.findsubstrings_suffix_arrays_python</span> <span class="kn">import</span> <span class="n">common_sub_strings</span>

<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">cseguid</span>

<span class="kn">from</span> <span class="nn">prettytable</span> <span class="kn">import</span> <span class="n">PrettyTable</span>

<span class="n">amb_compl</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;U&quot;</span><span class="p">:</span><span class="s">&quot;A&quot;</span><span class="p">})</span>
<span class="n">_complement_table</span> <span class="o">=</span> <span class="n">_maketrans</span><span class="p">(</span><span class="n">amb_compl</span><span class="p">)</span>

<div class="viewcode-block" id="rc"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.rc">[docs]</a><span class="k">def</span> <span class="nf">rc</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;returns the reverse complement of sequence (string)</span>
<span class="sd">    accepts mixed DNA/RNA</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">sequence</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">_complement_table</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Dseq"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq">[docs]</a><span class="k">class</span> <span class="nc">Dseq</span><span class="p">(</span><span class="n">Seq</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dseq is a class designed to hold information for a double stranded</span>
<span class="sd">    DNA fragment. Dseq also holds information describing the topology of</span>
<span class="sd">    the DNA fragment (linear or circular).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    watson : str</span>
<span class="sd">        a string representing the watson (sense) DNA strand.</span>

<span class="sd">    crick : str, optional</span>
<span class="sd">        a string representing the crick (antisense) DNA strand.</span>

<span class="sd">    ovhg : int, optional</span>
<span class="sd">        A positive or negative number to describe the stagger between the watson and crick strands.</span>
<span class="sd">        see below for a detailed explanation.</span>

<span class="sd">    linear : bool, optional</span>
<span class="sd">        True indicates that sequence is linear, False that it is circular.</span>

<span class="sd">    circular : bool, optional</span>
<span class="sd">        True indicates that sequence is circular, False that it is linear.</span>

<span class="sd">    alphabet : Bio.Alphabet, optional</span>
<span class="sd">        Bio.Alphabet.IUPAC.IUPACAmbiguousDNA from the Biopython package is set as default.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Dseq is a subclass of the Biopython Seq object. It stores two</span>
<span class="sd">    strings representing the watson (sense) and crick(antisense) strands.</span>
<span class="sd">    two properties called linear and circular, and a numeric value ovhg</span>
<span class="sd">    (overhang) describing the stagger for the watson and crick strand</span>
<span class="sd">    in the 5&#39; end of the fragment.</span>

<span class="sd">    The most common usage is probably to create a Dseq object as a</span>
<span class="sd">    part of a Dseqrecord object (see :class:`pydna.dsdna.Dseqrecord`).</span>

<span class="sd">    There are three ways of creating a Dseq object directly:</span>

<span class="sd">    Only one argument (string):</span>

<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;aaa&quot;)</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>

<span class="sd">    The given string will be interpreted as the watson strand of a</span>
<span class="sd">    blunt, linear double stranded sequence object. The crick strand</span>
<span class="sd">    is created automatically from the watson strand.</span>

<span class="sd">    Two arguments (string, string):</span>

<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;gggaaat&quot;,&quot;ttt&quot;)</span>
<span class="sd">    Dseq(-7)</span>
<span class="sd">    gggaaat</span>
<span class="sd">       ttt</span>

<span class="sd">    If both watson and crick are given, but not ovhg an attempt</span>
<span class="sd">    will be made to find the best annealing between the strands.</span>
<span class="sd">    There are limitations to this! For long fragments it is quite</span>
<span class="sd">    slow. The length of the annealing sequences have to be at least</span>
<span class="sd">    half the length of the shortest of the strands.</span>

<span class="sd">    Three arguments (string, string, ovhg=int):</span>

<span class="sd">    The ovhg parameter controls the stagger at the five prime end::</span>

<span class="sd">        ovhg=-2</span>

<span class="sd">        XXXXX</span>
<span class="sd">          XXXXX</span>

<span class="sd">        ovhg=-1</span>

<span class="sd">        XXXXX</span>
<span class="sd">         XXXXX</span>


<span class="sd">        ovhg=0</span>

<span class="sd">        XXXXX</span>
<span class="sd">        XXXXX</span>

<span class="sd">        ovhg=1</span>

<span class="sd">         XXXXX</span>
<span class="sd">        XXXXX</span>

<span class="sd">        ovhg=2</span>

<span class="sd">          XXXXX</span>
<span class="sd">        XXXXX</span>

<span class="sd">    Example of creating Dseq objects with different amounts of stagger:</span>

<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=-2)</span>
<span class="sd">    Dseq(-7)</span>
<span class="sd">    agt</span>
<span class="sd">      attca</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=-1)</span>
<span class="sd">    Dseq(-6)</span>
<span class="sd">    agt</span>
<span class="sd">     attca</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=0)</span>
<span class="sd">    Dseq(-5)</span>
<span class="sd">    agt</span>
<span class="sd">    attca</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=1)</span>
<span class="sd">    Dseq(-5)</span>
<span class="sd">     agt</span>
<span class="sd">    attca</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=2)</span>
<span class="sd">    Dseq(-5)</span>
<span class="sd">      agt</span>
<span class="sd">    attca</span>

<span class="sd">    If the ovhg parameter is psecified a crick strand also needs to be supplied,</span>
<span class="sd">    otherwise an exception is raised.</span>

<span class="sd">    &gt;&gt;&gt; pydna.Dseq(watson=&quot;agt&quot;,ovhg=2)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">      File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="sd">      File &quot;/usr/local/lib/python2.7/dist-packages/pydna_/dsdna.py&quot;, line 169, in __init__</span>
<span class="sd">        else:</span>
<span class="sd">    Exception: ovhg defined without crick strand!</span>


<span class="sd">    The default alphabet is set to Biopython IUPACAmbiguousDNA</span>

<span class="sd">    The shape of the fragment is set by either:</span>

<span class="sd">    1. linear   = False, True</span>
<span class="sd">    2. circular = True, False</span>

<span class="sd">    Note that both ends of the DNA fragment has to be compatible to set</span>
<span class="sd">    circular = True (or linear = False).</span>


<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;aaa&quot;,&quot;ttt&quot;)</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;aaa&quot;,&quot;ttt&quot;,ovhg=0)</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, linear = False ,ovhg=0)</span>
<span class="sd">    Dseq(o3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, circular = True , ovhg=0)</span>
<span class="sd">    Dseq(o3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>

<span class="sd">    Coercing to string</span>

<span class="sd">    &gt;&gt;&gt; a=pydna.Dseq(&quot;tttcccc&quot;,&quot;aaacccc&quot;)</span>
<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    Dseq(-11)</span>
<span class="sd">        tttcccc</span>
<span class="sd">    ccccaaa</span>

<span class="sd">    &gt;&gt;&gt; str(a)</span>
<span class="sd">    &#39;ggggtttcccc&#39;</span>

<span class="sd">    The double stranded part is accessible through the dsdata property:</span>

<span class="sd">    &gt;&gt;&gt; a.dsdata</span>
<span class="sd">    &#39;ttt&#39;</span>

<span class="sd">    A Dseq object can be longer that either the watson or crick strands.</span>

<span class="sd">    ::</span>

<span class="sd">        &lt;-- length --&gt;</span>
<span class="sd">        GATCCTTT</span>
<span class="sd">             AAAGCCTAG</span>



<span class="sd">    The slicing of a linear Dseq object works mostly as it does for a string.</span>


<span class="sd">    &gt;&gt;&gt; s=&quot;ggatcc&quot;</span>
<span class="sd">    &gt;&gt;&gt; s[2:3]</span>
<span class="sd">    &#39;a&#39;</span>
<span class="sd">    &gt;&gt;&gt; s[2:4]</span>
<span class="sd">    &#39;at&#39;</span>
<span class="sd">    &gt;&gt;&gt; s[2:4:-1]</span>
<span class="sd">    &#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; s[::2]</span>
<span class="sd">    &#39;gac&#39;</span>
<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; d=pydna.Dseq(s, linear=True)</span>
<span class="sd">    &gt;&gt;&gt; d[2:3]</span>
<span class="sd">    Dseq(-1)</span>
<span class="sd">    a</span>
<span class="sd">    t</span>
<span class="sd">    &gt;&gt;&gt; d[2:4]</span>
<span class="sd">    Dseq(-2)</span>
<span class="sd">    at</span>
<span class="sd">    ta</span>
<span class="sd">    &gt;&gt;&gt; d[2:4:-1]</span>
<span class="sd">    Dseq(-0)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; d[::2]</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    gac</span>
<span class="sd">    ctg</span>


<span class="sd">    The slicing of a circular Dseq object has a slightly different meaning.</span>


<span class="sd">    &gt;&gt;&gt; s=&quot;ggAtCc&quot;</span>
<span class="sd">    &gt;&gt;&gt; d=pydna.Dseq(s, circular=True)</span>
<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    Dseq(o6)</span>
<span class="sd">    ggAtCc</span>
<span class="sd">    ccTaGg</span>
<span class="sd">    &gt;&gt;&gt; d[4:3]</span>
<span class="sd">    Dseq(-5)</span>
<span class="sd">    CcggA</span>
<span class="sd">    GgccT</span>


<span class="sd">    The slice [X:X] produces an empty slice for a string, while this will return</span>
<span class="sd">    the linearized sequence starting at X:</span>

<span class="sd">    &gt;&gt;&gt; s=&quot;ggatcc&quot;</span>
<span class="sd">    &gt;&gt;&gt; d=pydna.Dseq(s, circular=True)</span>
<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    Dseq(o6)</span>
<span class="sd">    ggatcc</span>
<span class="sd">    cctagg</span>
<span class="sd">    &gt;&gt;&gt; d[3:3]</span>
<span class="sd">    Dseq(-6)</span>
<span class="sd">    tccgga</span>
<span class="sd">    aggcct</span>
<span class="sd">    &gt;&gt;&gt;</span>


<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    pydna.dsdna.Dseqrecord</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">watson</span><span class="p">,</span>
                  <span class="n">crick</span>         <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">ovhg</span>          <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">linear</span>        <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">circular</span>      <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">alphabet</span>      <span class="o">=</span> <span class="n">IUPACAmbiguousDNA</span><span class="p">()):</span>


        <span class="k">if</span> <span class="n">ovhg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crick</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crick</span> <span class="o">=</span> <span class="n">rc</span><span class="p">(</span><span class="n">watson</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">olaps</span> <span class="o">=</span> <span class="n">common_sub_strings</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">watson</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                                           <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">(</span><span class="n">crick</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">watson</span><span class="p">))</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">F</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">L</span> <span class="o">=</span> <span class="n">olaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Could not anneal the two strands! &quot;</span>
                                    <span class="s">&quot;ovhg should be provided&quot;</span><span class="p">)</span>
                <span class="n">ovhgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">olaps</span> <span class="k">if</span> <span class="n">ol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">L</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ovhgs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ovhgs</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">o</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;More than one way of annealing the strands &quot;</span>
                                    <span class="s">&quot;ovhg should be provided&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span> <span class="o">=</span> <span class="n">T</span><span class="o">-</span><span class="n">F</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crick</span> <span class="o">=</span> <span class="n">crick</span>
        <span class="k">elif</span> <span class="n">crick</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;ovhg defined without crick strand!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span> <span class="o">=</span> <span class="n">ovhg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crick</span> <span class="o">=</span> <span class="n">crick</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">watson</span> <span class="o">=</span> <span class="n">watson</span>

        <span class="n">sns</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span><span class="p">)</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">))</span>
        <span class="n">asn</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">todata</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip_longest</span><span class="p">(</span><span class="n">sns</span><span class="p">,</span><span class="n">asn</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsdata</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip_longest</span><span class="p">(</span><span class="n">sns</span><span class="p">,</span><span class="n">asn</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">b</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>

        <span class="k">if</span> <span class="n">circular</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">linear</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>   <span class="o">=</span> <span class="n">linear</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">linear</span>
        <span class="k">elif</span> <span class="n">linear</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">circular</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span> <span class="o">=</span> <span class="n">circular</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>   <span class="o">=</span> <span class="ow">not</span> <span class="n">circular</span>
        <span class="k">elif</span> <span class="n">circular</span> <span class="o">==</span> <span class="n">linear</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>   <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">linear</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">circular</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">circular</span> <span class="o">!=</span> <span class="n">linear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span> <span class="o">=</span> <span class="n">circular</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>   <span class="o">=</span> <span class="ow">not</span> <span class="n">circular</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;circular and linear argument set to {} and {}, respectively</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">circular</span><span class="p">,</span><span class="n">linear</span><span class="p">)</span><span class="o">+</span>
                            <span class="s">&quot;circular and linear are each others opposites.&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">!=</span> <span class="s">&quot;blunt&quot;</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;blunt&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;DNA is circular, but has staggered ends!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">Seq</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">todata</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">)</span>

<div class="viewcode-block" id="Dseq.find"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find method, like that of a python string.</span>

<span class="sd">        This behaves like the python string method of the same name.</span>

<span class="sd">        Returns an integer, the index of the first occurrence of substring</span>
<span class="sd">        argument sub in the (sub)sequence given by [start:end].</span>

<span class="sd">        Returns -1 if the subsequence is NOT found.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        sub : string or Seq object</span>
<span class="sd">            a string or another Seq object to look for.</span>

<span class="sd">        start : int, optional</span>
<span class="sd">            slice start.</span>

<span class="sd">        end : int, optional</span>
<span class="sd">            slice end.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; seq = Dseq(&quot;atcgactgacgtgtt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; seq</span>
<span class="sd">        Dseq(-15)</span>
<span class="sd">        atcgactgacgtgtt</span>
<span class="sd">        tagctgactgcacaa</span>
<span class="sd">        &gt;&gt;&gt; seq.find(&quot;gac&quot;)</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; seq = pydna.Dseq(watson=&quot;agt&quot;,crick=&quot;actta&quot;,ovhg=-2)</span>
<span class="sd">        &gt;&gt;&gt; seq</span>
<span class="sd">        Dseq(-7)</span>
<span class="sd">        agt</span>
<span class="sd">          attca</span>
<span class="sd">        &gt;&gt;&gt; seq.find(&quot;taa&quot;)</span>
<span class="sd">        2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="n">sub_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_seq_str_and_check_alphabet</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sub_str</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>


</div>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a subsequence.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="n">sns</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)[</span><span class="n">sl</span><span class="p">]</span>
            <span class="n">asn</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="n">sl</span><span class="p">]</span>
            <span class="n">ovhg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()),</span>
                        <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">asn</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">asn</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())),</span>
                        <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">asn</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">ovhg</span><span class="o">=</span><span class="n">ovhg</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="n">sl</span><span class="o">.</span><span class="n">stop</span>  <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                       <span class="n">sl</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sl</span><span class="o">.</span><span class="n">start</span><span class="o">&lt;</span><span class="n">sl</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[</span><span class="n">sl</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">sl</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#print sl.start,sl.stop, &quot;&lt;---&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">stp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">stp</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">start</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">start</span>
                <span class="n">stop</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">stop</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
                    <span class="n">start</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[(</span><span class="n">start</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))::</span><span class="n">stp</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[:(</span><span class="n">stop</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">):</span><span class="n">stp</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="n">stop</span><span class="p">::</span><span class="n">stp</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="n">start</span><span class="p">:</span><span class="n">stp</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Compare to another Dseq object OR an object that implements</span>
<span class="sd">        watson, crick and ovhg properties. This comparison is case</span>
<span class="sd">        insensitive.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">same</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">watson</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">crick</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="ow">and</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">ovhg</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">same</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">same</span>


<div class="viewcode-block" id="Dseq.fig"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.fig">[docs]</a>    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a representation of the sequence, truncated if</span>
<span class="sd">       longer than 30 bp:</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>

<span class="sd">       &gt;&gt;&gt; import pydna</span>
<span class="sd">       &gt;&gt;&gt; a=pydna.Dseq(&quot;atcgcttactagcgtactgatcatctgact&quot;)</span>
<span class="sd">       &gt;&gt;&gt; a</span>
<span class="sd">       Dseq(-30)</span>
<span class="sd">       atcgcttactagcgtactgatcatctgact</span>
<span class="sd">       tagcgaatgatcgcatgactagtagactga</span>
<span class="sd">       &gt;&gt;&gt; a+=Dseq(&quot;A&quot;)</span>
<span class="sd">       &gt;&gt;&gt; a</span>
<span class="sd">       Dseq(-31)</span>
<span class="sd">       atcg..actA</span>
<span class="sd">       tagc..tgaT</span>


<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a representation of the sequence, truncated if</span>
<span class="sd">        longer than 30 bp&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">hej</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="s">&quot; &quot;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[:</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)]</span>
                <span class="n">hej</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="s">&quot; &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">d</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">hej</span><span class="o">=</span><span class="mi">0</span>

            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="p">:]</span>
                <span class="n">y</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="s">&quot; &quot;</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[:</span><span class="o">-</span><span class="n">x</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
                <span class="n">c</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="s">&quot; &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">f</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>

            <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="n">hej</span><span class="o">-</span><span class="n">y</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span><span class="o">+</span><span class="n">L</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span><span class="o">+</span><span class="n">L</span>

            <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span>
            <span class="n">e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="n">x3</span><span class="p">:</span><span class="n">x4</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
                <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;{}..{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

            <span class="c">#import sys;sys.exit()</span>

            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;{klass}({top}{size})</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="s">&quot;{a}{b}{c}</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="s">&quot;{d}{e}{f}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                          <span class="n">top</span> <span class="o">=</span> <span class="p">{</span><span class="bp">True</span><span class="p">:</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">:</span><span class="s">&quot;o&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">],</span>
                                          <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                          <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                          <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
                                          <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                                          <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                                          <span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                                          <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;{}({}{})</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                                <span class="p">{</span><span class="bp">True</span><span class="p">:</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">:</span><span class="s">&quot;o&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">],</span>
                                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">,</span>
                                               <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">*</span><span class="s">&quot; &quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<div class="viewcode-block" id="Dseq.rc"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.rc">[docs]</a>    <span class="k">def</span> <span class="nf">rc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alias of the reverse_complement method&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Dseq.reverse_complement"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.reverse_complement">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_complement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a Dseq object where watson and crick have switched</span>
<span class="sd">        places.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;catcgatc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-8)</span>
<span class="sd">        catcgatc</span>
<span class="sd">        gtagctag</span>
<span class="sd">        &gt;&gt;&gt; b=a.reverse_complement()</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseq(-8)</span>
<span class="sd">        gatcgatg</span>
<span class="sd">        ctagctac</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="n">ovhg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span>
        <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">,</span> <span class="n">ovhg</span><span class="o">=</span><span class="n">ovhg</span><span class="p">,</span> <span class="n">circular</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.looped"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.looped">[docs]</a>    <span class="k">def</span> <span class="nf">looped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a circularized Dseq object. This can only be done if the</span>
<span class="sd">        two ends are compatible, otherwise a TypeError is raised.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;catcgatc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-8)</span>
<span class="sd">        catcgatc</span>
<span class="sd">        gtagctag</span>
<span class="sd">        &gt;&gt;&gt; a.looped()</span>
<span class="sd">        Dseq(o8)</span>
<span class="sd">        catcgatc</span>
<span class="sd">        gtagctag</span>
<span class="sd">        &gt;&gt;&gt; a.T4(&quot;t&quot;)</span>
<span class="sd">        Dseq(-8)</span>
<span class="sd">        catcgat</span>
<span class="sd">         tagctag</span>
<span class="sd">        &gt;&gt;&gt; a.T4(&quot;t&quot;).looped()</span>
<span class="sd">        Dseq(o7)</span>
<span class="sd">        catcgat</span>
<span class="sd">        gtagcta</span>
<span class="sd">        &gt;&gt;&gt; a.T4(&quot;a&quot;)</span>
<span class="sd">        Dseq(-8)</span>
<span class="sd">        catcga</span>
<span class="sd">          agctag</span>
<span class="sd">        &gt;&gt;&gt; a.T4(&quot;a&quot;).looped()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="sd">          File &quot;/usr/local/lib/python2.7/dist-packages/pydna/dsdna.py&quot;, line 357, in looped</span>
<span class="sd">            if type5 == type3 and str(sticky5) == str(rc(sticky3)):</span>
<span class="sd">        TypeError: DNA cannot be circularized.</span>
<span class="sd">        5&#39; and 3&#39; sticky ends not compatible!</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">type5</span><span class="p">,</span> <span class="n">sticky5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>
        <span class="n">type3</span><span class="p">,</span> <span class="n">sticky3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">type5</span> <span class="o">==</span> <span class="n">type3</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">sticky5</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">(</span><span class="n">sticky3</span><span class="p">)):</span>
            <span class="n">nseq</span> <span class="o">=</span> <span class="n">Dseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nseq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">nseq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nseq</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;DNA cannot be circularized.</span><span class="se">\n</span><span class="s">&quot;</span>
                             <span class="s">&quot;5&#39; and 3&#39; sticky ends not compatible!&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.tolinear"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.tolinear">[docs]</a>    <span class="k">def</span> <span class="nf">tolinear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a blunt, linear copy of a circular Dseq object. This can</span>
<span class="sd">       only be done if the Dseq object is circular, otherwise a</span>
<span class="sd">       TypeError is raised.</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>

<span class="sd">       &gt;&gt;&gt; import pydna</span>
<span class="sd">       &gt;&gt;&gt; a=pydna.Dseq(&quot;catcgatc&quot;, circular=True)</span>
<span class="sd">       &gt;&gt;&gt; a</span>
<span class="sd">       Dseq(o8)</span>
<span class="sd">       catcgatc</span>
<span class="sd">       gtagctag</span>
<span class="sd">       &gt;&gt;&gt; a.tolinear()</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       catcgatc</span>
<span class="sd">       gtagctag</span>
<span class="sd">       &gt;&gt;&gt;</span>

<span class="sd">       &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;DNA is not circular.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">,</span> <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.five_prime_end"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.five_prime_end">[docs]</a>    <span class="k">def</span> <span class="nf">five_prime_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a tuple describing the structure of the 5&#39; end of</span>
<span class="sd">        the DNA fragment</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; a.five_prime_end()</span>
<span class="sd">        (&#39;blunt&#39;, &#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, ovhg=1)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">         aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; a.five_prime_end()</span>
<span class="sd">        (&quot;3&#39;&quot;, &#39;t&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, ovhg=-1)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">        aaa</span>
<span class="sd">         ttt</span>
<span class="sd">        &gt;&gt;&gt; a.five_prime_end()</span>
<span class="sd">        (&quot;5&#39;&quot;, &#39;a&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dsdna.Dseq.three_prime_end</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;5&#39;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;3&#39;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;5&#39;&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;3&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;blunt&quot;</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">,</span> <span class="n">sticky</span>
</div>
<div class="viewcode-block" id="Dseq.three_prime_end"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.three_prime_end">[docs]</a>    <span class="k">def</span> <span class="nf">three_prime_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a tuple describing the structure of the 5&#39; end of</span>
<span class="sd">        the DNA fragment</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; a.three_prime_end()</span>
<span class="sd">        (&#39;blunt&#39;, &#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, ovhg=1)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">         aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; a.three_prime_end()</span>
<span class="sd">        (&quot;3&#39;&quot;, &#39;a&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;, ovhg=-1)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">        aaa</span>
<span class="sd">         ttt</span>
<span class="sd">        &gt;&gt;&gt; a.three_prime_end()</span>
<span class="sd">        (&quot;5&#39;&quot;, &#39;t&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dsdna.Dseq.five_prime_end</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ovhg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span>

        <span class="k">if</span> <span class="n">ovhg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[:</span><span class="o">-</span><span class="n">ovhg</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;5&#39;&quot;</span>
        <span class="k">elif</span> <span class="n">ovhg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[</span><span class="o">-</span><span class="n">ovhg</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;3&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sticky</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;blunt&quot;</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">,</span> <span class="n">sticky</span>
</div>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Simulates ligation between two DNA fragments.</span>

<span class="sd">        Add other Dseq object at the end of the sequence.</span>
<span class="sd">        Type error if all of the points below are fulfilled:</span>

<span class="sd">        * either objects are circular</span>
<span class="sd">        * if three prime sticky end of self is not the same type</span>
<span class="sd">          (5&#39; or 3&#39;) as the sticky end of other</span>
<span class="sd">        * three prime sticky end of self complementary with five</span>
<span class="sd">          prime sticky end of other.</span>

<span class="sd">        Phosphorylation and dephosphorylation is not considered.</span>
<span class="sd">        DNA is allways presumed to have the necessary 5&#39; phospate</span>
<span class="sd">        group necessary for ligation.</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="c"># test for circular DNA</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;circular DNA cannot be ligated!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;circular DNA cannot be ligated!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">self_type</span><span class="p">,</span>  <span class="n">self_tail</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()</span>
        <span class="n">other_type</span><span class="p">,</span> <span class="n">other_tail</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">self_type</span> <span class="o">==</span> <span class="n">other_type</span> <span class="ow">and</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">self_tail</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">(</span><span class="n">other_tail</span><span class="p">))):</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">watson</span><span class="p">,</span>
                          <span class="n">other</span><span class="o">.</span><span class="n">crick</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">other</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;sticky ends not compatible!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;TypeError: can&#39;t multiply Dseq by non-int of type {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">number</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">new</span> <span class="o">+=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">_fill_in_five_prime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleotides</span><span class="p">):</span>
        <span class="n">stuffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;5&#39;&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rc</span><span class="p">(</span><span class="n">se</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nucleotides</span><span class="p">:</span>
                    <span class="n">stuffer</span><span class="o">+=</span><span class="n">n</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="o">+</span><span class="n">stuffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">stuffer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fill_in_three_prime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleotides</span><span class="p">):</span>
        <span class="n">stuffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;5&#39;&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rc</span><span class="p">(</span><span class="n">se</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nucleotides</span><span class="p">:</span>
                    <span class="n">stuffer</span><span class="o">+=</span><span class="n">n</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="o">+</span><span class="n">stuffer</span>

<div class="viewcode-block" id="Dseq.fill_in"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.fill_in">[docs]</a>    <span class="k">def</span> <span class="nf">fill_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleotides</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fill in of five prime protruding end with a DNA polymerase</span>
<span class="sd">        that has only DNA polymerase activity (such as exo-klenow [#]_)</span>
<span class="sd">        and any combination of A, G, C or T. Default are all four</span>
<span class="sd">        nucleotides together.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        nucleotides : str</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseq(&quot;aaa&quot;, &quot;ttt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; a.fill_in()</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; b=pydna.Dseq(&quot;caaa&quot;, &quot;cttt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        caaa</span>
<span class="sd">         tttc</span>
<span class="sd">        &gt;&gt;&gt; b.fill_in()</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        caaag</span>
<span class="sd">        gtttc</span>
<span class="sd">        &gt;&gt;&gt; b.fill_in(&quot;g&quot;)</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        caaag</span>
<span class="sd">        gtttc</span>
<span class="sd">        &gt;&gt;&gt; b.fill_in(&quot;tac&quot;)</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        caaa</span>
<span class="sd">         tttc</span>
<span class="sd">        &gt;&gt;&gt; c=pydna.Dseq(&quot;aaac&quot;, &quot;tttg&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">         aaac</span>
<span class="sd">        gttt</span>
<span class="sd">        &gt;&gt;&gt; c.fill_in()</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">         aaac</span>
<span class="sd">        gttt</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [#] http://en.wikipedia.org/wiki/Klenow_fragment#The_exo-_Klenow_fragment</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nucleotides</span><span class="p">:</span>
            <span class="n">nucleotides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="o">.</span><span class="n">letters</span>
        <span class="n">nucleotides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nucleotides</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="n">nucleotides</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">crick</span><span class="p">,</span> <span class="n">ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_in_five_prime</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="n">watson</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_in_three_prime</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="n">watson</span><span class="p">,</span> <span class="n">crick</span><span class="p">,</span> <span class="n">ovhg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.mung"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.mung">[docs]</a>    <span class="k">def</span> <span class="nf">mung</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       Simulates treatment a nuclease with 5&#39;-3&#39; and 3&#39;-5&#39; single</span>
<span class="sd">       strand specific exonuclease activity (such as mung bean nuclease [#]_)</span>

<span class="sd">       ::</span>

<span class="sd">            ggatcc    -&gt;     gatcc</span>
<span class="sd">             ctaggg          ctagg</span>

<span class="sd">             ggatcc   -&gt;      ggatc</span>
<span class="sd">            tcctag            cctag</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; b=pydna.Dseq(&quot;caaa&quot;, &quot;cttt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        caaa</span>
<span class="sd">         tttc</span>
<span class="sd">        &gt;&gt;&gt; b.mung()</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>
<span class="sd">        &gt;&gt;&gt; c=pydna.Dseq(&quot;aaac&quot;, &quot;tttg&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">         aaac</span>
<span class="sd">        gttt</span>
<span class="sd">        &gt;&gt;&gt; c.mung()</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aaa</span>
<span class="sd">        ttt</span>



<span class="sd">       References</span>
<span class="sd">       ----------</span>
<span class="sd">       .. [#] http://en.wikipedia.org/wiki/Mung_bean_nuclease</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.t4"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.t4">[docs]</a>    <span class="k">def</span> <span class="nf">t4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alias for the :func:`T4` method &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">T4</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseq.T4"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.T4">[docs]</a>    <span class="k">def</span> <span class="nf">T4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleotides</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fill in of five prime protruding ends and chewing back of</span>
<span class="sd">       three prime protruding ends by a DNA polymerase providing both</span>
<span class="sd">       5&#39;-3&#39; DNA polymerase activity and 3&#39;-5&#39; nuclease acitivty</span>
<span class="sd">       (such as T4 DNA polymerase). This can be done in presence of any</span>
<span class="sd">       combination of the four A, G, C or T. Default are all four</span>
<span class="sd">       nucleotides together.</span>

<span class="sd">       Alias for the :func:`t4` method</span>

<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>

<span class="sd">       nucleotides : str</span>


<span class="sd">       Examples</span>
<span class="sd">       --------</span>

<span class="sd">       &gt;&gt;&gt; import pydna</span>
<span class="sd">       &gt;&gt;&gt; a=pydna.Dseq(&quot;gatcgatc&quot;)</span>
<span class="sd">       &gt;&gt;&gt; a</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       gatcgatc</span>
<span class="sd">       ctagctag</span>
<span class="sd">       &gt;&gt;&gt; a.T4()</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       gatcgatc</span>
<span class="sd">       ctagctag</span>
<span class="sd">       &gt;&gt;&gt; a.T4(&quot;t&quot;)</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       gatcgat</span>
<span class="sd">        tagctag</span>
<span class="sd">       &gt;&gt;&gt; a.T4(&quot;a&quot;)</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       gatcga</span>
<span class="sd">         agctag</span>
<span class="sd">       &gt;&gt;&gt; a.T4(&quot;g&quot;)</span>
<span class="sd">       Dseq(-8)</span>
<span class="sd">       gatcg</span>
<span class="sd">          gctag</span>
<span class="sd">       &gt;&gt;&gt;</span>

<span class="sd">       &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">nucleotides</span><span class="p">:</span> <span class="n">nucleotides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="o">.</span><span class="n">letters</span>
        <span class="n">nucleotides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nucleotides</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">nucleotides</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>
        <span class="n">crick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;5&#39;&quot;</span><span class="p">:</span>
            <span class="n">crick</span><span class="p">,</span> <span class="n">ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_in_five_prime</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;3&#39;&quot;</span><span class="p">:</span>
                <span class="n">ovhg</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">crick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crick</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">se</span><span class="p">)]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">crick</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crick</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">in</span> <span class="n">nucleotides</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">x</span><span class="o">-=</span><span class="mi">1</span>
        <span class="n">ovhg</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">crick</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">crick</span> <span class="o">=</span> <span class="n">crick</span><span class="p">[:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">crick</span><span class="p">:</span> <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">watson</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;5&#39;&quot;</span><span class="p">:</span>
            <span class="n">watson</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_in_three_prime</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;3&#39;&quot;</span><span class="p">:</span>
                <span class="n">watson</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">se</span><span class="p">)]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">watson</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">watson</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">in</span> <span class="n">nucleotides</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">x</span><span class="o">-=</span><span class="mi">1</span>
        <span class="n">watson</span><span class="o">=</span><span class="n">watson</span><span class="p">[:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Dseq</span><span class="p">(</span><span class="n">watson</span><span class="p">,</span> <span class="n">crick</span><span class="p">,</span> <span class="n">ovhg</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">enzymes</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">enzymes</span> <span class="o">=</span> <span class="n">output</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enzymes</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">enzymes</span> <span class="o">=</span> <span class="p">(</span><span class="n">enzymes</span><span class="p">,)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">frags</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="p">,]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frags</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">,]</span>

        <span class="n">newfrags</span><span class="o">=</span><span class="p">[]</span>

        <span class="n">enzymes</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">enzyme</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dsdata</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">enzyme</span><span class="p">)</span> <span class="k">for</span> <span class="n">enzyme</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">enzymes</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">,]</span>

        <span class="k">for</span> <span class="n">enzyme</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frags</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">enzyme</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">dsdata</span><span class="p">)):</span>

                    <span class="n">watson_fragments</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">enzyme</span><span class="o">.</span><span class="n">catalyze</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">watson</span><span class="o">+</span><span class="s">&quot;N&quot;</span><span class="p">))]</span>
                    <span class="n">crick_fragments</span>  <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">enzyme</span><span class="o">.</span><span class="n">catalyze</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">crick</span><span class="o">+</span><span class="s">&quot;N&quot;</span> <span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

                    <span class="n">watson_fragments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">watson_fragments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">crick_fragments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">crick_fragments</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">s</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">watson_fragments</span><span class="p">,</span> <span class="n">crick_fragments</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">frag</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
                        <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseq</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                             <span class="n">ovhg</span> <span class="o">=</span> <span class="n">frag</span><span class="o">.</span><span class="n">ovhg</span><span class="p">,</span>
                                             <span class="n">linear</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">seqs</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                            <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseq</span><span class="p">(</span><span class="o">*</span><span class="n">seqs</span><span class="p">,</span>
                                                 <span class="n">ovhg</span> <span class="o">=</span> <span class="n">enzyme</span><span class="o">.</span><span class="n">ovhg</span><span class="p">,</span>
                                                 <span class="n">linear</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">seqs</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                            <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseq</span><span class="p">(</span><span class="o">*</span><span class="n">seqs</span><span class="p">,</span>
                                                 <span class="n">ovhg</span><span class="o">=</span><span class="n">enzyme</span><span class="o">.</span><span class="n">ovhg</span><span class="p">,</span>
                                                 <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>
            <span class="n">frags</span><span class="o">=</span><span class="n">newfrags</span>
            <span class="n">newfrags</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">swl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span>
            <span class="n">frags</span> <span class="o">=</span> <span class="n">frags</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newfrags</span> <span class="o">=</span> <span class="p">[</span><span class="n">frags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),]</span>
            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">newfrags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">swl</span><span class="p">:</span>
                <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">frags</span> <span class="o">=</span> <span class="n">newfrags</span>

        <span class="k">return</span> <span class="n">frags</span>

<div class="viewcode-block" id="Dseq.cut"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a list of linear Dseq fragments produced in the digestion.</span>
<span class="sd">        If there are no cuts, an empty list is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        enzymes : enzyme object or iterable of such objects</span>
<span class="sd">            A Bio.Restriction.XXX restriction objects or iterable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frags : list</span>
<span class="sd">            list of Dseq objects formed by the digestion</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna import Dseq</span>
<span class="sd">        &gt;&gt;&gt; seq=Dseq(&quot;ggatccnnngaattc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; seq</span>
<span class="sd">        Dseq(-15)</span>
<span class="sd">        ggatccnnngaattc</span>
<span class="sd">        cctaggnnncttaag</span>
<span class="sd">        &gt;&gt;&gt; from Bio.Restriction import BamHI,EcoRI</span>
<span class="sd">        &gt;&gt;&gt; type(seq.cut(BamHI))</span>
<span class="sd">        &lt;type &#39;list&#39;&gt;</span>
<span class="sd">        &gt;&gt;&gt; for frag in seq.cut(BamHI):</span>
<span class="sd">        ...     print frag.fig()</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        g</span>
<span class="sd">        cctag</span>
<span class="sd">        Dseq(-14)</span>
<span class="sd">        gatccnnngaattc</span>
<span class="sd">            gnnncttaag</span>
<span class="sd">        &gt;&gt;&gt; seq.cut(EcoRI, BamHI) ==  seq.cut(BamHI, EcoRI)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; a,b,c = seq.cut(EcoRI, BamHI)</span>
<span class="sd">        &gt;&gt;&gt; a+b+c</span>
<span class="sd">        Dseq(-15)</span>
<span class="sd">        ggatccnnngaattc</span>
<span class="sd">        cctaggnnncttaag</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">enzymes</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">enzymes</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enzymes</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">enzymes</span> <span class="o">=</span> <span class="p">(</span><span class="n">enzymes</span><span class="p">,)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">frags</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="p">,]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frags</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">,]</span>

        <span class="n">newfrags</span><span class="o">=</span><span class="p">[]</span>

        <span class="n">enzymes</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">enzyme</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dsdata</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">enzyme</span><span class="p">)</span> <span class="k">for</span> <span class="n">enzyme</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">enzymes</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">enz</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frags</span><span class="p">:</span>

                <span class="n">ws</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">enz</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;N&quot;</span><span class="p">)]</span> <span class="c">#, linear = frag.linear</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">enz</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;N&quot;</span><span class="p">)]</span> <span class="c">#, linear = frag.linear</span>

                <span class="n">sitepairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sw</span><span class="p">,</span> <span class="n">sc</span><span class="p">)</span> <span class="k">for</span> <span class="n">sw</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">cs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                             <span class="k">if</span> <span class="p">(</span><span class="n">sw</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frag</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span> <span class="o">-</span>
                             <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">enz</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span>
                             <span class="o">==</span>
                             <span class="nb">len</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span><span class="o">-</span><span class="n">sc</span> <span class="o">-</span>
                             <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frag</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span> <span class="o">+</span>
                             <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">enz</span><span class="o">.</span><span class="n">ovhg</span><span class="p">))]</span>

                <span class="n">sitepairs</span> <span class="o">=</span> <span class="n">sitepairs</span> <span class="o">+</span> <span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">watson</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>

                <span class="n">w2</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">sitepairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">nwat</span> <span class="o">=</span> <span class="n">frag</span><span class="o">.</span><span class="n">watson</span><span class="p">[:</span><span class="n">w2</span><span class="p">]</span>
                <span class="n">ncrk</span> <span class="o">=</span> <span class="n">frag</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="n">c1</span><span class="p">:]</span>

                <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseq</span><span class="p">(</span><span class="n">nwat</span><span class="p">,</span> <span class="n">ncrk</span><span class="p">,</span> <span class="n">ovhg</span><span class="o">=</span><span class="n">frag</span><span class="o">.</span><span class="n">ovhg</span><span class="p">))</span>

                <span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sitepairs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sitepairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="n">nwat</span> <span class="o">=</span> <span class="n">frag</span><span class="o">.</span><span class="n">watson</span><span class="p">[</span><span class="n">w1</span><span class="p">:</span><span class="n">w2</span><span class="p">]</span>
                    <span class="n">ncrk</span> <span class="o">=</span> <span class="n">frag</span><span class="o">.</span><span class="n">crick</span><span class="p">[</span><span class="n">c1</span><span class="p">:</span><span class="n">c2</span><span class="p">]</span>
                    <span class="n">newfrag</span> <span class="o">=</span> <span class="n">Dseq</span><span class="p">(</span><span class="n">nwat</span><span class="p">,</span> <span class="n">ncrk</span><span class="p">,</span> <span class="n">ovhg</span> <span class="o">=</span> <span class="n">enz</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span>
                    <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newfrag</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">newfrags</span><span class="p">:</span>
                    <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>

            <span class="n">frags</span><span class="o">=</span><span class="n">newfrags</span>
            <span class="n">newfrags</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">swl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span>
            <span class="n">frags</span> <span class="o">=</span> <span class="n">frags</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newfrags</span> <span class="o">=</span> <span class="p">[</span><span class="n">frags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),]</span>
            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">newfrags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">swl</span><span class="p">:</span>
                <span class="n">newfrags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">frags</span> <span class="o">=</span> <span class="n">newfrags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newfrags</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frags</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Dseq.ovhg"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.ovhg">[docs]</a>    <span class="k">def</span> <span class="nf">ovhg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The ovhg property&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ovhg</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Dseq.linear"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.linear">[docs]</a>    <span class="k">def</span> <span class="nf">linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The linear property&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Dseq.circular"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseq.circular">[docs]</a>    <span class="k">def</span> <span class="nf">circular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The circular property&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_circular</span>

</div></div>
<div class="viewcode-block" id="Dseqrecord"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord">[docs]</a><span class="k">class</span> <span class="nc">Dseqrecord</span><span class="p">(</span><span class="n">SeqRecord</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dseqrecord is a double stranded version of the Biopython SeqRecord [#]_ class.</span>
<span class="sd">    The Dseqrecord object holds a Dseq object describing the sequence.</span>
<span class="sd">    Additionally, Dseqrecord hold meta information about the sequence in the</span>
<span class="sd">    from of a list of SeqFeatures, in the same way as the SeqRecord does.</span>
<span class="sd">    The Dseqrecord can be initialized with a string, Seq, Dseq, SeqRecord</span>
<span class="sd">    or another Dseqrecord. The sequence information will be stored in a</span>
<span class="sd">    Dseq object in all cases. Dseqrecord objects can be read or parsed</span>
<span class="sd">    from sequences in Fasta, Embl or Genbank format.</span>

<span class="sd">    There is a short representation associated with the Dseqrecord.</span>
<span class="sd">    ``Dseqrecord(-3)`` represents a linear sequence of length 2</span>
<span class="sd">    while ``Dseqrecord(o7)``</span>
<span class="sd">    represents a circular sequence of length 7.</span>

<span class="sd">    Dseqrecord and Dseq share the same concept of length</span>

<span class="sd">    ::</span>

<span class="sd">        &lt;-- length --&gt;</span>
<span class="sd">        GATCCTTT</span>
<span class="sd">             AAAGCCTAG</span>




<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    record  : string, Seq, SeqRecord, Dseq or other Dseqrecord object</span>
<span class="sd">        This data will be used to form the seq property</span>

<span class="sd">    circular : bool, optional</span>
<span class="sd">        True or False reflecting the shape of the DNA molecule</span>

<span class="sd">    linear : bool, optional</span>
<span class="sd">        True or False reflecting the shape of the DNA molecule</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pydna import Dseqrecord</span>
<span class="sd">    &gt;&gt;&gt; a=Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; a.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; from Bio.Seq import Seq</span>
<span class="sd">    &gt;&gt;&gt; b=Dseqrecord(Seq(&quot;aaa&quot;))</span>
<span class="sd">    &gt;&gt;&gt; b</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; b.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqRecord import SeqRecord</span>
<span class="sd">    &gt;&gt;&gt; c=Dseqrecord(SeqRecord(Seq(&quot;aaa&quot;)))</span>
<span class="sd">    &gt;&gt;&gt; c</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; c.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; a.seq.alphabet</span>
<span class="sd">    IUPACAmbiguousDNA()</span>
<span class="sd">    &gt;&gt;&gt; b.seq.alphabet</span>
<span class="sd">    IUPACAmbiguousDNA()</span>
<span class="sd">    &gt;&gt;&gt; c.seq.alphabet</span>
<span class="sd">    IUPACAmbiguousDNA()</span>
<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [#] http://biopython.org/wiki/SeqRecord</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span>
                       <span class="n">circular</span>               <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                       <span class="n">linear</span>                 <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                       <span class="n">n</span>                      <span class="o">=</span> <span class="mf">10E-12</span><span class="p">,</span> <span class="c"># pmols</span>
                       <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">circular</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">linear</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,):</span>
            <span class="n">circular</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">linear</span>
        <span class="k">elif</span> <span class="n">linear</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">circular</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,):</span>
            <span class="n">linear</span>   <span class="o">=</span> <span class="ow">not</span> <span class="n">circular</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>  <span class="c"># record is a string</span>
            <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">Dseq</span><span class="p">(</span><span class="n">record</span><span class="p">,</span>
                                    <span class="n">rc</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
                                    <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span> <span class="p">,</span>
                                    <span class="n">linear</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span>
                                    <span class="n">circular</span><span class="o">=</span><span class="n">circular</span><span class="p">),</span>
                               <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s">&quot;features&quot;</span><span class="p">):</span> <span class="c"># record is SeqRecord or Dseqrecord?</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span> <span class="c"># record.seq is a Dseq, so record is Dseqrecord</span>
                <span class="n">new_seq</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_seq</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">linear</span><span class="p">:</span>
                    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">new_seq</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">new_seq</span><span class="o">.</span><span class="n">linear</span> <span class="ow">and</span> <span class="n">circular</span><span class="p">:</span>
                    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">new_seq</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">=</span><span class="n">new_seq</span>
            <span class="k">else</span><span class="p">:</span>                             <span class="c"># record is Bio.SeqRecord</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">=</span><span class="n">Dseq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                              <span class="n">rc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)),</span>
                              <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span> <span class="p">,</span>
                              <span class="n">linear</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span>
                              <span class="n">circular</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span>      <span class="c"># record is Dseq ?</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">linear</span><span class="p">:</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">linear</span> <span class="ow">and</span> <span class="n">circular</span><span class="p">:</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
            <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Seq</span><span class="p">):</span>         <span class="c"># record is Bio.Seq ?</span>
            <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dseq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
                                          <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">()),</span>
                                          <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span> <span class="p">,</span>
                                          <span class="n">linear</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span>
                                          <span class="n">circular</span><span class="o">=</span><span class="n">circular</span><span class="p">),</span>
                                          <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">((</span><span class="s">&quot;record argument needs to be a string,&quot;</span>
                              <span class="s">&quot;Seq, SeqRecord, Dseq or Dseqrecord object,&quot;</span>
                              <span class="s">&quot; got {}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">record</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span><span class="s">&quot;.&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;date&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">-%b-%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()})</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Dseqrecord.linear"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.linear">[docs]</a>    <span class="k">def</span> <span class="nf">linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The linear property&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">linear</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Dseqrecord.circular"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.circular">[docs]</a>    <span class="k">def</span> <span class="nf">circular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The circular property&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">circular</span>
</div>
<div class="viewcode-block" id="Dseqrecord.seguid"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.seguid">[docs]</a>    <span class="k">def</span> <span class="nf">seguid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the SEGUID [#]_ for the sequence.</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>
<span class="sd">       &gt;&gt;&gt; import pydna</span>
<span class="sd">       &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">       &gt;&gt;&gt; a.seguid()</span>
<span class="sd">       &#39;YG7G6b2Kj/KtFOX63j8mRHHoIlE&#39;</span>

<span class="sd">       References</span>
<span class="sd">       ----------</span>

<span class="sd">       .. [#] http://wiki.christophchamp.com/index.php/SEGUID</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">seguid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseqrecord.isorf"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.isorf">[docs]</a>    <span class="k">def</span> <span class="nf">isorf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Detects if sequence is an open reading frame (orf) in the 5&#39;-3&#39; direction.</span>
<span class="sd">        Translation tables are numbers according to the NCBI numbering [#]_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table  : int</span>
<span class="sd">            Sets the translation table, default is 1 (standard code)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if sequence is an orf, False otherwise.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.isorf()</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; b=Dseqrecord(&quot;atgaaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; b.isorf()</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; c=Dseqrecord(&quot;atttaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c.isorf()</span>
<span class="sd">        False</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [#] http://www.ncbi.nlm.nih.gov/Taxonomy/Utils/wprintgc.cgi?mode=c</span>

<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">cds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TranslationError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    </div>
<div class="viewcode-block" id="Dseqrecord.add_feature"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.add_feature">[docs]</a>    <span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a feature of type misc to the feature list of the sequence.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x  : int</span>
<span class="sd">            Indicates start of the feature       </span>
<span class="sd">        y  : int</span>
<span class="sd">            Indicates end of the feature</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.features</span>
<span class="sd">        []</span>
<span class="sd">        &gt;&gt;&gt; a.add_feature(2,4)</span>
<span class="sd">        &gt;&gt;&gt; a.features</span>
<span class="sd">        [SeqFeature(FeatureLocation(ExactPosition(2), ExactPosition(4)), type=&#39;misc&#39;)]</span>
<span class="sd">        &#39;&#39;&#39;</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;misc&quot;</span> <span class="p">))</span>    
            </div>
<div class="viewcode-block" id="Dseqrecord.extract_feature"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.extract_feature">[docs]</a>    <span class="k">def</span> <span class="nf">extract_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extracts a feature and creates a new Dseqrecord object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n  : int</span>
<span class="sd">            Indicates the feature to extract       </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.add_feature(2,4)</span>
<span class="sd">        &gt;&gt;&gt; b=a.extract_feature(0)</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(-2)</span>
<span class="sd">        &gt;&gt;&gt; b.seq</span>
<span class="sd">        Dseq(-2)</span>
<span class="sd">        gt</span>
<span class="sd">        ca</span>
<span class="sd">                </span>
<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Dseqrecord.list_features"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.list_features">[docs]</a>    <span class="k">def</span> <span class="nf">list_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Prints an ASCII table with all features.    </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.add_feature(2,4)</span>
<span class="sd">        &gt;&gt;&gt; a.list_features()</span>
<span class="sd">        +----------+-----------+-------+-----+--------+--------------+------+------+</span>
<span class="sd">        | Feature# | Direction | Start | End | Length | id           | type | orf? |</span>
<span class="sd">        +----------+-----------+-------+-----+--------+--------------+------+------+</span>
<span class="sd">        | 0        |    None   |   2   |  4  |      2 | &lt;unknown id&gt; | misc |  no  |</span>
<span class="sd">        +----------+-----------+-------+-----+--------+--------------+------+------+</span>
<span class="sd">        &gt;&gt;&gt;                </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">PrettyTable</span><span class="p">([</span><span class="s">&quot;Feature#&quot;</span><span class="p">,</span> <span class="s">&quot;Direction&quot;</span><span class="p">,</span> <span class="s">&quot;Start&quot;</span><span class="p">,</span> <span class="s">&quot;End&quot;</span><span class="p">,</span> <span class="s">&quot;Length&quot;</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;orf?&quot;</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">align</span><span class="p">[</span><span class="s">&quot;Feature#&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;l&quot;</span> <span class="c"># Left align</span>
        <span class="n">x</span><span class="o">.</span><span class="n">align</span><span class="p">[</span><span class="s">&quot;Length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;r&quot;</span>
        <span class="n">x</span><span class="o">.</span><span class="n">align</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;l&quot;</span>
        <span class="n">x</span><span class="o">.</span><span class="n">align</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;l&quot;</span>
        <span class="n">x</span><span class="o">.</span><span class="n">padding_width</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># One space between column edges and contents</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span> <span class="n">i</span><span class="p">,</span> 
                        <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&quot;--&gt;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s">&quot;&lt;--&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="s">&quot;---&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">:</span><span class="s">&quot;None&quot;</span><span class="p">}[</span><span class="n">sf</span><span class="o">.</span><span class="n">strand</span><span class="p">],</span>
                        <span class="n">sf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                        <span class="n">sf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">),</span> <span class="n">sf</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> 
                        <span class="p">{</span><span class="bp">True</span><span class="p">:</span><span class="s">&quot;yes&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">:</span><span class="s">&quot;no&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_feature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isorf</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_feature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">rc</span><span class="p">()</span><span class="o">.</span><span class="n">isorf</span><span class="p">()]])</span>
        <span class="k">print</span> <span class="n">x</span>
        <span class="k">return</span>


</div>
<div class="viewcode-block" id="Dseqrecord.cseguid"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.cseguid">[docs]</a>    <span class="k">def</span> <span class="nf">cseguid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the cSEGUID for the sequence. The cSEGUID is the SEGUID</span>
<span class="sd">        checksum calculated for the lexicographically minimal string rotation</span>
<span class="sd">        of the sequence or its reverse complement.</span>

<span class="sd">        Only defined for circular sequences.</span>

<span class="sd">        The cSEGUID checksum uniqely identifies a circular sequence.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaat&quot;, circular=True)</span>
<span class="sd">        &gt;&gt;&gt; a.cseguid()</span>
<span class="sd">        &#39;oopV+6158nHJqedi8lsshIfcqYA&#39;</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;ataa&quot;, circular=True)</span>
<span class="sd">        &gt;&gt;&gt; a.cseguid()</span>
<span class="sd">        &#39;oopV+6158nHJqedi8lsshIfcqYA&#39;</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;cseguid is only defined for circular sequences.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cseguid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dseqrecord.stamp"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.stamp">[docs]</a>    <span class="k">def</span> <span class="nf">stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a seguid stamp to the description property. This will</span>
<span class="sd">        show in the genbank format. The following string:</span>

<span class="sd">        ``SEGUID &lt;seguid&gt;``</span>

<span class="sd">        will be appended to the description property of the Dseqrecord</span>
<span class="sd">        object (string).</span>

<span class="sd">        The stamp can be verified with :func:`verify_stamp`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.stamp()</span>
<span class="sd">        &gt;&gt;&gt; a.description</span>
<span class="sd">        &#39;&lt;unknown description&gt; SEGUID YG7G6b2Kj/KtFOX63j8mRHHoIlE&#39;</span>
<span class="sd">        &gt;&gt;&gt; a.verify_stamp()</span>
<span class="sd">        True</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dsdna.Dseqrecord.verify_stamp</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;(SEGUID|seguid)\s*\S{27}&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="s">&quot;SEGUID {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seguid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">stamp</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">stamp</span>
</div>
<div class="viewcode-block" id="Dseqrecord.verify_stamp"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.verify_stamp">[docs]</a>    <span class="k">def</span> <span class="nf">verify_stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Verifies the SEGUID stamp in the description property is</span>
<span class="sd">       valid. True if stamp match the sequid calculated from the sequence.</span>
<span class="sd">       Exception raised if no stamp can be found.</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.annotations[&#39;date&#39;] = &#39;02-FEB-2013&#39;</span>
<span class="sd">        &gt;&gt;&gt; a.seguid()</span>
<span class="sd">        &#39;YG7G6b2Kj/KtFOX63j8mRHHoIlE&#39;</span>
<span class="sd">        &gt;&gt;&gt; print a.format(&quot;gb&quot;)</span>
<span class="sd">        LOCUS       .                          3 bp    DNA     linear   UNK 02-FEB-2013</span>
<span class="sd">        DEFINITION  .</span>
<span class="sd">        ACCESSION   &lt;unknown id&gt;</span>
<span class="sd">        VERSION     &lt;unknown id&gt;</span>
<span class="sd">        KEYWORDS    .</span>
<span class="sd">        SOURCE      .</span>
<span class="sd">          ORGANISM  .</span>
<span class="sd">                    .</span>
<span class="sd">        FEATURES             Location/Qualifiers</span>
<span class="sd">        ORIGIN</span>
<span class="sd">                1 aaa</span>
<span class="sd">        //</span>
<span class="sd">        &gt;&gt;&gt; a.stamp()</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt; print a.format(&quot;gb&quot;)</span>
<span class="sd">        LOCUS       .                          3 bp    DNA     linear   UNK 02-FEB-2013</span>
<span class="sd">        DEFINITION  &lt;unknown description&gt; SEGUID YG7G6b2Kj/KtFOX63j8mRHHoIlE</span>
<span class="sd">        ACCESSION   &lt;unknown id&gt;</span>
<span class="sd">        VERSION     &lt;unknown id&gt;</span>
<span class="sd">        KEYWORDS    .</span>
<span class="sd">        SOURCE      .</span>
<span class="sd">          ORGANISM  .</span>
<span class="sd">                    .</span>
<span class="sd">        FEATURES             Location/Qualifiers</span>
<span class="sd">        ORIGIN</span>
<span class="sd">                1 aaa</span>
<span class="sd">        //</span>
<span class="sd">        &gt;&gt;&gt; a.verify_stamp()</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">       See also</span>
<span class="sd">       --------</span>
<span class="sd">       pydna.dsdna.Dseqrecord.stamp</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;(SEGUID|seguid)\s*\S{27}&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;No stamp present in the description property.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">seguid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="n">stamp</span><span class="p">[</span><span class="o">-</span><span class="mi">27</span><span class="p">:]</span>
</div>
<div class="viewcode-block" id="Dseqrecord.looped"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.looped">[docs]</a>    <span class="k">def</span> <span class="nf">looped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a circular version of the Dseqrecord object. The</span>
<span class="sd">        underlying Dseq object has to have compatible ends.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt; b=a.looped()</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(o3)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dsdna.Dseq.looped</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">qualifiers</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">qualifiers</span>

        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Dseqrecord.tolinear"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.tolinear">[docs]</a>    <span class="k">def</span> <span class="nf">tolinear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a linear, blunt copy of a circular Dseqrecord object. The</span>
<span class="sd">        underlying Dseq object has to be circular.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;, circular = True)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(o3)</span>
<span class="sd">        &gt;&gt;&gt; b=a.tolinear()</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">qualifiers</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">qualifiers</span>

        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Dseqrecord.format"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s">&quot;gb&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the sequence as a string using a format supported by Biopython</span>
<span class="sd">        SeqIO [#]_. Default is &quot;gb&quot; which is short for Genbank.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.annotations[&#39;date&#39;] = &#39;02-FEB-2013&#39;</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt; print a.format()</span>
<span class="sd">        LOCUS       .                          3 bp    DNA     linear   UNK 02-FEB-2013</span>
<span class="sd">        DEFINITION  .</span>
<span class="sd">        ACCESSION   &lt;unknown id&gt;</span>
<span class="sd">        VERSION     &lt;unknown id&gt;</span>
<span class="sd">        KEYWORDS    .</span>
<span class="sd">        SOURCE      .</span>
<span class="sd">          ORGANISM  .</span>
<span class="sd">                    .</span>
<span class="sd">        FEATURES             Location/Qualifiers</span>
<span class="sd">        ORIGIN</span>
<span class="sd">                1 aaa</span>
<span class="sd">        //</span>


<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [#] http://biopython.org/wiki/SeqIO</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;genbank&quot;</span><span class="p">,</span><span class="s">&quot;gb&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="mi">55</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;circular&quot;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">63</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="mi">55</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;linear&quot;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">61</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="Dseqrecord.write"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s">&quot;gb&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Writes the Dseqrecord to a file using the format f, which must</span>
<span class="sd">        be a format supported by Biopython SeqIO for writing [#]_. Default</span>
<span class="sd">        is &quot;gb&quot; which is short for Genbank. Note that Biopython SeqIO reads</span>
<span class="sd">        more formats than it writes.</span>

<span class="sd">        Filename is the path to the file where the sequece is to be</span>
<span class="sd">        written. The filename is optional, if it is not given, the</span>
<span class="sd">        description property (string) is used together with the format.</span>

<span class="sd">        If obj is the Dseqrecord object, the default file name will be:</span>

<span class="sd">        ``&lt;obj.description&gt;.&lt;f&gt;``</span>

<span class="sd">        Where &lt;f&gt; is &quot;gb&quot; by default. If the filename already exists and</span>
<span class="sd">        AND the sequence it contains is different, a new file name will be</span>
<span class="sd">        used so that the old file is not lost:</span>

<span class="sd">        ``&lt;obj.description&gt;_NEW.&lt;f&gt;``</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [#] http://biopython.org/wiki/SeqIO</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">f</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="n">seguid_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span>
                <span class="n">old_file</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">seguid_old</span> <span class="o">=</span> <span class="n">old_file</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span>
                <span class="k">if</span>  <span class="n">seguid_new</span> <span class="o">==</span> <span class="n">seguid_old</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="o">==</span> <span class="n">old_file</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">new_filename</span> <span class="o">=</span> <span class="s">&quot;{}_NEW{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">seguid(old) = {} in file {}&quot;</span>
                           <span class="s">&quot;</span><span class="se">\n</span><span class="s">seguid(new) = {} in file {}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seguid_old</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">seguid_new</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">filename</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;Dseqrecord</span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot;circular: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot;size: {}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">+</span><span class="n">SeqRecord</span><span class="o">.</span><span class="n">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Dseqrecord({}{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="bp">True</span><span class="p">:</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">:</span><span class="s">&quot;o&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;seq&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span>
            <span class="n">other</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">_shift</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
            <span class="c">#answer = self.__class__(SeqRecord.__add__(self, other))</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">SeqRecord</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#answer = self.__class__(SeqRecord.__add__(self, Dseqrecord(other)))</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">SeqRecord</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;TypeError: can&#39;t multiply Dseqrecord by non-int of type {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;TypeError: can&#39;t multiply circular Dseqrecord&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">+=</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="n">new</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">alphabet</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="p">)</span><span class="o">.</span><span class="n">features</span>
        <span class="k">return</span> <span class="n">answer</span>

<div class="viewcode-block" id="Dseqrecord.linearize"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.linearize">[docs]</a>    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This method is similar to :func:`cut` but throws an exception if there</span>
<span class="sd">        is not excactly on cut i.e. none or more than one digestion products.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">_linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can only linearize circular molecules!&quot;</span><span class="p">)</span>
        <span class="n">fragments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="o">*</span><span class="n">enzymes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;More than one fragment is formed!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fragments</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;The enzyme(s) do not cut!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fragments</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Dseqrecord.cut"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Digest the Dseqrecord object with one or more restriction enzymes.</span>
<span class="sd">        returns a list of linear Dseqrecords. If there are no cuts, an empty</span>
<span class="sd">        list is returned.</span>

<span class="sd">        See also :func:`Dseq.cut`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        enzymes : enzyme object or iterable of such objects</span>
<span class="sd">            A Bio.Restriction.XXX restriction object or iterable of such.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dseqrecord_frags : list</span>
<span class="sd">            list of Dseqrecord objects formed by the digestion</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;ggatcc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from Bio.Restriction import BamHI</span>
<span class="sd">        &gt;&gt;&gt; a.cut(BamHI)</span>
<span class="sd">        [Dseqrecord(-5), Dseqrecord(-5)]</span>
<span class="sd">        &gt;&gt;&gt; frag1, frag2 = a.cut(BamHI)</span>
<span class="sd">        &gt;&gt;&gt; frag1.seq</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        g</span>
<span class="sd">        cctag</span>
<span class="sd">        &gt;&gt;&gt; frag2.seq</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        gatcc</span>
<span class="sd">            g</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">stack</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">enzymes</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">enzymes</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enzymes</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">enzymes</span> <span class="o">=</span> <span class="p">(</span><span class="n">enzymes</span><span class="p">,)</span>

        <span class="n">frags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">enzymes</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">frags</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="n">last_pos</span><span class="o">=</span><span class="mi">0</span>
            <span class="c">#template = self.__class__(self, linear=True)</span>
            <span class="c">#template = copy.copy(self)</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">enzyme</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span>
                         <span class="nb">sorted</span><span class="p">([(</span><span class="n">enzyme</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">dsdata</span><span class="p">),</span>
                                                <span class="n">linear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                   <span class="n">enzyme</span><span class="p">)</span> <span class="k">for</span> <span class="n">enzyme</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">])</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_pos</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">last_pos</span><span class="p">:</span>
                <span class="n">last_pos</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">last_pos</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiply_circular</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">Dseqrecord_frags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">last_pos</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frags</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">Dseqrecord_frag</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">features</span>

            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">annotations</span>         <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">annotations</span><span class="p">)</span>
            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">name</span>                <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">dbxrefs</span>             <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">dbxrefs</span><span class="p">)</span>
            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">id</span>                  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">letter_annotations</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">letter_annotations</span><span class="p">)</span>

            <span class="n">Dseqrecord_frag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">)</span>

            <span class="n">Dseqrecord_frags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseqrecord_frag</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
            <span class="n">start</span><span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">three_prime_end</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Dseqrecord_frags</span>

</div>
<div class="viewcode-block" id="Dseqrecord.reverse_complement"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.reverse_complement">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_complement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the reverse complement.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;ggaatt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-6)</span>
<span class="sd">        &gt;&gt;&gt; a.seq</span>
<span class="sd">        Dseq(-6)</span>
<span class="sd">        ggaatt</span>
<span class="sd">        ccttaa</span>
<span class="sd">        &gt;&gt;&gt; a.reverse_complement().seq</span>
<span class="sd">        Dseq(-6)</span>
<span class="sd">        aattcc</span>
<span class="sd">        ttaagg</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dsdna.Dseq.reverse_complement</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Dseqrecord.rc"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.rc">[docs]</a>    <span class="k">def</span> <span class="nf">rc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;alias of the reverse_complement method&#39;&#39;&#39;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">Dseqrecord</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">())</span>
        <span class="k">assert</span> <span class="n">answer</span><span class="o">.</span><span class="n">circular</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;{}_rc&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">description</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">+</span><span class="s">&quot;_rc&quot;</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">id</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s">&quot;_rc&quot;</span>
        <span class="k">return</span> <span class="n">answer</span>
        <span class="c">#return Dseqrecord(self.seq.rc())</span>

</div>
    <span class="k">def</span> <span class="nf">_multiply_circular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a linearised version of a circular sequence multiplied by</span>
<span class="sd">       multiplier &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;sequence has to be circular!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;TypeError: can&#39;t multiply Dseq by non-int of type {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">multiplier</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">new_features</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">new_feature</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>    <span class="c"># CompoundFeature</span>
                <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeatureLocation</span><span class="p">(</span><span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                                                        <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">del</span> <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">slask</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">fl</span> <span class="ow">in</span> <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fl</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">slask</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                        <span class="n">slask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">slask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="o">=</span><span class="n">slask</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_feature</span><span class="o">.</span><span class="n">location</span><span class="o">=</span><span class="n">slask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolinear</span><span class="p">()</span>
        <span class="n">sequence</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">new_features</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span> <span class="o">*</span> <span class="n">multiplier</span>

        <span class="n">sequence</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)]</span>
        <span class="n">sequence</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;location.start&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sequence</span>

<div class="viewcode-block" id="Dseqrecord.shifted"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.shifted">[docs]</a>    <span class="k">def</span> <span class="nf">shifted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a circular Dseqrecord with a new origin &lt;shift&gt;.</span>
<span class="sd">         This only works on circular Dseqrecords. If we consider the following</span>
<span class="sd">         circular sequence:</span>


<span class="sd">         | ``GAAAT   &lt;-- watson strand``</span>
<span class="sd">         | ``CTTTA   &lt;-- crick strand``</span>

<span class="sd">         The T and the G on the watson strand are linked together as well</span>
<span class="sd">         as the A and the C of the of the crick strand.</span>

<span class="sd">         if ``shift`` is 1, this indicates a new origin at position 1:</span>

<span class="sd">         |    new origin at the | symbol:</span>
<span class="sd">         |</span>
<span class="sd">         | ``G|AAAT``</span>
<span class="sd">         | ``C|TTTA``</span>

<span class="sd">         new sequence:</span>

<span class="sd">         | ``AAATG``</span>
<span class="sd">         | ``TTTAC``</span>

<span class="sd">         Shift is always positive and 0&lt;shift&lt;length, so in the example</span>
<span class="sd">         below, permissible values of shift are 1,2 and 3</span>

<span class="sd">         Examples</span>
<span class="sd">         --------</span>

<span class="sd">         &gt;&gt;&gt; import pydna</span>
<span class="sd">         &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;aaat&quot;,circular=True)</span>
<span class="sd">         &gt;&gt;&gt; a</span>
<span class="sd">         Dseqrecord(o4)</span>
<span class="sd">         &gt;&gt;&gt; a.seq</span>
<span class="sd">         Dseq(o4)</span>
<span class="sd">         aaat</span>
<span class="sd">         ttta</span>
<span class="sd">         &gt;&gt;&gt; b=a.shifted(1)</span>
<span class="sd">         &gt;&gt;&gt; b</span>
<span class="sd">         Dseqrecord(o4)</span>
<span class="sd">         &gt;&gt;&gt; b.seq</span>
<span class="sd">         Dseq(o4)</span>
<span class="sd">         aata</span>
<span class="sd">         ttat</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Sequence is linear.</span><span class="se">\n</span><span class="s">&quot;</span>
                             <span class="s">&quot;The origin can only be</span><span class="se">\n</span><span class="s">&quot;</span>
                             <span class="s">&quot;shifted for a circular sequence!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span><span class="o">&lt;</span><span class="n">shift</span><span class="o">&lt;</span><span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;shift is {}, has to be 0&lt;shift&lt;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiply_circular</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="n">shift</span><span class="p">:]</span>

        <span class="n">features_to_fold</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="o">&lt;</span><span class="n">length</span><span class="o">&lt;</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>

        <span class="n">folded_features</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features_to_fold</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="c"># CompoundFeature</span>
                <span class="n">nps</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="o">&lt;</span><span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="o">&lt;=</span><span class="n">length</span><span class="p">:</span>
                        <span class="n">nps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="o">&lt;</span><span class="n">length</span><span class="o">&lt;</span><span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                        <span class="n">nps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">length</span><span class="p">))</span>
                        <span class="n">nps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="o">-</span><span class="n">length</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="n">length</span><span class="o">&lt;=</span><span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="o">&lt;</span><span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                        <span class="n">nps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="o">-</span><span class="n">length</span><span class="p">))</span>

                <span class="n">folded_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">CompoundLocation</span><span class="p">(</span><span class="n">nps</span><span class="p">),</span>
                                                  <span class="n">qualifiers</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">,</span>
                                                  <span class="nb">type</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">folded_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">CompoundLocation</span><span class="p">([</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span>
                                                                    <span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="o">-</span><span class="n">length</span><span class="p">)]),</span>
                                                  <span class="n">qualifiers</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">,</span>
                                                  <span class="nb">type</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

        <span class="n">new</span> <span class="o">=</span> <span class="n">new</span><span class="p">[:</span><span class="n">length</span><span class="p">]</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">folded_features</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;location.start&#39;</span><span class="p">))</span>
        <span class="n">new</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="c">#!</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Dseqrecord.synced"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.Dseqrecord.synced">[docs]</a>    <span class="k">def</span> <span class="nf">synced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This function returns a new circular sequence (Dseqrecord object), which has ben rotated</span>
<span class="sd">        in such a way that there is maximum overlap between the sequence and</span>
<span class="sd">        ref, which may be a string, Biopython Seq, SeqRecord object or</span>
<span class="sd">        another Dseqrecord object.</span>

<span class="sd">        The reason for using this could be to rotate a recombinant plasmid so</span>
<span class="sd">        that it starts at the same position after cloning. See the example below:</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import pydna</span>
<span class="sd">        &gt;&gt;&gt; a=pydna.Dseqrecord(&quot;gaat&quot;,circular=True)</span>
<span class="sd">        &gt;&gt;&gt; a.seq</span>
<span class="sd">        Dseq(o4)</span>
<span class="sd">        gaat</span>
<span class="sd">        ctta</span>
<span class="sd">        &gt;&gt;&gt; d = a[2:] + a[:2]</span>
<span class="sd">        &gt;&gt;&gt; d.seq</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">        atga</span>
<span class="sd">        tact</span>
<span class="sd">        &gt;&gt;&gt; insert=pydna.Dseqrecord(&quot;CCC&quot;)</span>
<span class="sd">        &gt;&gt;&gt; recombinant = (d+insert).looped()</span>
<span class="sd">        &gt;&gt;&gt; recombinant.seq</span>
<span class="sd">        Dseq(o7)</span>
<span class="sd">        atgaCCC</span>
<span class="sd">        tactGGG</span>
<span class="sd">        &gt;&gt;&gt; recombinant.synced(a).seq</span>
<span class="sd">        Dseq(o7)</span>
<span class="sd">        gaCCCat</span>
<span class="sd">        ctGGGta</span>


<span class="sd">        &#39;&#39;&#39;</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Only circular DNA can be synced!&quot;</span><span class="p">)</span>

        <span class="n">newseq</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">s</span>    <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">s_rc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s">&quot;seq&quot;</span><span class="p">):</span>
            <span class="n">r</span><span class="o">=</span><span class="n">ref</span><span class="o">.</span><span class="n">seq</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">circular_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">circular</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">circular_ref</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">lim</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">limit</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">common_sub_strings</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">s</span><span class="p">,</span>       <span class="n">r</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="n">lim</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">common_sub_strings</span><span class="p">(</span><span class="n">s_rc</span><span class="o">+</span><span class="n">s_rc</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="n">lim</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span>  <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span>  <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;There is no overlap between sequences!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">start_rc</span><span class="p">,</span> <span class="n">length_rc</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_rc</span><span class="p">,</span> <span class="n">length_rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">length_rc</span><span class="o">&gt;</span><span class="n">length</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start_rc</span>
            <span class="n">newseq</span> <span class="o">=</span> <span class="n">newseq</span><span class="o">.</span><span class="n">rc</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">newseq</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">newseq</span><span class="o">.</span><span class="n">shifted</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function is similar the :func:`parse` function but expects one and only</span>
<span class="sd">    one sequence or and exception is thrown.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : string</span>
<span class="sd">        see below</span>
<span class="sd">    ds : bool</span>
<span class="sd">        Double stranded or single stranded DNA, Return</span>
<span class="sd">        &quot;Dseqrecord&quot; or &quot;SeqRecord&quot; objects.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dseqrecord</span>
<span class="sd">        contains the first Dseqrecord or SeqRecord object parsed.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The data parameter is similar to the data parameter for :func:`parse`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    parse</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No sequences found in data ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">30</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">results</span>



</div>
<div class="viewcode-block" id="parse_new"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.parse_new">[docs]</a><span class="k">def</span> <span class="nf">parse_new</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span>  <span class="s">r&quot;(?:&gt;.+\n^(?:^[^&gt;]+?)(?=\n\n|&gt;|LOCUS|ID))|(?:(?:LOCUS|ID)(?:(?:.|\n)+?)^//)&quot;</span>

    <span class="k">def</span> <span class="nf">extract_seqs</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span>   <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">raw</span><span class="o">+</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">),</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">rawseqs</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pth</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">pth</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">rawseqs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extract_seqs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
            <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rawseqs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extract_seqs</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">rawseqs</span><span class="p">:</span>
        <span class="n">circular</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">rawseq</span> <span class="o">=</span> <span class="n">rawseqs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">rawseq</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;embl&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
            <span class="n">original_format</span> <span class="o">=</span> <span class="s">&quot;embl&quot;</span>
            <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">rawseq</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;genbank&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
                <span class="n">original_format</span> <span class="o">=</span> <span class="s">&quot;genbank&quot;</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="n">RecordParser</span><span class="p">()</span>
                <span class="n">residue_type</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="o">.</span><span class="n">residue_type</span>
                <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">residue_type</span><span class="p">:</span>
                    <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;fasta&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
                    <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">rawseq</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">if</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseqrecord</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">circular</span> <span class="o">=</span> <span class="n">circular</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sequences</span>
</div>
<div class="viewcode-block" id="parse"><a class="viewcode-back" href="../../pydna.html#pydna.dsdna.parse">[docs]</a><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function returns *all* DNA sequences found in data. If no</span>
<span class="sd">    sequences are found, an empty list is returned. This is a greedy</span>
<span class="sd">    function, use carefully.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : string or iterable</span>
<span class="sd">        The data parameter is a string containing:</span>

<span class="sd">        1. an absolute path to a local file.</span>
<span class="sd">           The file will be read in text</span>
<span class="sd">           mode and parsed for EMBL, FASTA</span>
<span class="sd">           and Genbank sequences.</span>

<span class="sd">        2. an absolute path to a local directory.</span>
<span class="sd">           All files in the directory will be</span>
<span class="sd">           read and parsed as in 1.</span>

<span class="sd">        3. a string containing one or more</span>
<span class="sd">           sequences in EMBL, GENBANK,</span>
<span class="sd">           or FASTA format. Mixed formats</span>
<span class="sd">           are allowed.</span>

<span class="sd">        4. data can be a list or other iterable of 1 - 3</span>

<span class="sd">    ds : bool</span>
<span class="sd">        If True double stranded :class:`Dseqrecord` objects are returned.</span>
<span class="sd">        If False single stranded :class:`Bio.SeqRecord` [#]_ objects are returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        contains Dseqrecord or SeqRecord objects</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [#] http://biopython.org/wiki/SeqRecord</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    read</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">raw</span><span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">raw</span><span class="o">+=</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="o">+</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">item</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">raw</span><span class="o">+=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw</span><span class="o">+=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">pattern</span> <span class="o">=</span>  <span class="s">r&quot;(?:&gt;.+\n^(?:^[^&gt;]+?)(?=\n\n|&gt;|LOCUS|ID))|(?:(?:LOCUS|ID)(?:(?:.|\n)+?)^//)&quot;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span>   <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">rawseqs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">raw</span><span class="o">+</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">),</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">sequences</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">while</span> <span class="n">rawseqs</span><span class="p">:</span>
        <span class="n">circular</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">rawseq</span> <span class="o">=</span> <span class="n">rawseqs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">rawseq</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;embl&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
            <span class="n">original_format</span> <span class="o">=</span> <span class="s">&quot;embl&quot;</span>
            <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">rawseq</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;genbank&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
                <span class="n">original_format</span> <span class="o">=</span> <span class="s">&quot;genbank&quot;</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="n">RecordParser</span><span class="p">()</span>
                <span class="n">residue_type</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="o">.</span><span class="n">residue_type</span>
                <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">residue_type</span><span class="p">:</span>
                    <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parsed</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&quot;fasta&quot;</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">IUPACAmbiguousDNA</span><span class="p">())</span>
                    <span class="n">original_format</span> <span class="o">=</span> <span class="s">&quot;fasta&quot;</span>
                    <span class="k">if</span> <span class="s">&quot;circular&quot;</span> <span class="ow">in</span> <span class="n">rawseq</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">circular</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">if</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dseqrecord</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">circular</span> <span class="o">=</span> <span class="n">circular</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c">#sequences[0].features[8].qualifiers[&#39;label&#39;][0] = u&#39;bj√∂rn&#39;</span>
    <span class="k">return</span> <span class="n">sequences</span>

    <span class="c">#http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?</span>
    <span class="c">#db=nuccore&amp;</span>
    <span class="c">#id=21614549&amp;</span>
    <span class="c">#strand=1&amp;</span>
    <span class="c">#seq_start=1&amp;</span>
    <span class="c">#seq_stop=100&amp;</span>
    <span class="c">#rettype=gb&amp;</span>
    <span class="c">#retmode=text</span>
</div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pydna 0.6.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Bj√∂rn Johansson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>