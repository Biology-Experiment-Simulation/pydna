
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pydna.gel &#8212; Pydna 3.0.1+2.g47ae1f65a3.dirty documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Pydna 3.0.1+2.g47ae1f65a3.dirty documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../pydna.html" accesskey="U">pydna</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pydna.gel</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># doctest: +NORMALIZE_WHITESPACE</span>
<span class="c1"># doctest: +SKIP</span>

<span class="c1"># Copyright 2015 by Bruno Silva &lt;bruno.phoenix@gmail.com&gt;, Bj√∂rn Johansson.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1"># This code is part of the Python-dna distribution and governed by its</span>
<span class="c1"># license.  Please see the LICENSE.txt file that should have been included</span>
<span class="c1"># as part of this package.</span>

<span class="c1"># from pint import UnitRegistry #, DimensionalityError</span>
<span class="c1"># Hacky fix for a python3 problem I don&#39;t understand</span>
<span class="c1"># https://github.com/pallets/flask/issues/1680</span>
<span class="c1"># UnitRegistry.__wrapped__ = None</span>
<span class="c1"># ureg = UnitRegistry()</span>

<span class="sd">&quot;&quot;&quot;Provides the class `Gel` for the simulation of agarose slab-gel</span>
<span class="sd">electrophoresis of DNA at constant electric field.</span>

<span class="sd">Note</span>
<span class="sd">----</span>
<span class="sd">This code is at an early stage of development and documentation.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>

<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">_mtick</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">_plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span>    <span class="k">as</span> <span class="nn">_cm</span>
<span class="kn">from</span>   <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">FixedLocator</span> <span class="k">as</span> <span class="n">_FixedLocator</span>

<span class="c1"># from mpldatacursor import datacursor as _datacursor #, HighlightingDataCursor  # version 0.5.0</span>

<span class="kn">from</span> <span class="nn">scipy.interpolate</span>    <span class="k">import</span> <span class="n">griddata</span> <span class="k">as</span> <span class="n">_griddata</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span>       <span class="k">import</span> <span class="n">leastsq</span>  <span class="k">as</span> <span class="n">_leastsq</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span>       <span class="k">import</span> <span class="n">fsolve</span>   <span class="k">as</span> <span class="n">_fsolve</span>
<span class="kn">from</span> <span class="nn">scipy</span>                <span class="k">import</span> <span class="n">stats</span>    <span class="k">as</span> <span class="n">_stats</span>

<span class="kn">from</span> <span class="nn">pint</span>                 <span class="k">import</span> <span class="n">UnitRegistry</span> <span class="k">as</span> <span class="n">_UnitRegistry</span>
<span class="kn">from</span> <span class="nn">io</span>                   <span class="k">import</span> <span class="n">BytesIO</span>      <span class="k">as</span> <span class="n">_BytesIO</span>
<span class="kn">from</span> <span class="nn">pydna.dseq</span>           <span class="k">import</span> <span class="n">Dseq</span>         <span class="k">as</span> <span class="n">_Dseq</span>
<span class="kn">from</span> <span class="nn">pydna.dseqrecord</span>     <span class="k">import</span> <span class="n">Dseqrecord</span>   <span class="k">as</span> <span class="n">_Dseqrecord</span>


<span class="c1"># Hacky fix for a python3 problem I don&#39;t understand</span>
<span class="c1"># https://github.com/pallets/flask/issues/1680</span>
<span class="n">_UnitRegistry</span><span class="o">.</span><span class="n">__wrapped__</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Unit registry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">_UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span>
<span class="n">ureg</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;base_pair = [] = bp = basepair&#39;</span><span class="p">)</span>
<span class="c1"># ureg.define(&#39;base_pair = 3.4 angstrom = bp = basepair&#39;)</span>
<span class="n">ureg</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pixel = [] = px&#39;</span><span class="p">)</span>
<span class="n">ureg</span><span class="o">.</span><span class="n">default_format</span> <span class="o">=</span> <span class="s1">&#39;~&#39;</span>


<span class="c1"># Variable mapping</span>
<span class="n">Vars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;synonyms&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;electric field&#39;</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;V/cm&#39;</span><span class="p">,</span>
              <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Electric field intensity as given by the applied &quot;</span>
                          <span class="s2">&quot;voltage divided by the distance between the &quot;</span>
                          <span class="s2">&quot;electrodes.&quot;</span><span class="p">)},</span>
        <span class="s1">&#39;quantities&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;synonyms&#39;</span><span class="p">:</span> <span class="p">(),</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;ng&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s2">&quot;Mass of DNA in a sample or a band.&quot;</span><span class="p">},</span>
        <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;synonyms&#39;</span><span class="p">:</span> <span class="p">(),</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;ul&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
        <span class="p">}</span>


<span class="c1"># Weight standards</span>
<span class="n">weight_standards</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;1kb_GeneRuler&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sizes&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span>
                     <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span> <span class="s1">&#39;bp&#39;</span><span class="p">),</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>
                       <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="p">},</span>
    <span class="s1">&#39;1kb+_GeneRuler&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sizes&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span>
                     <span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="s1">&#39;bp&#39;</span><span class="p">),</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>
                       <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="p">},</span>
    <span class="s1">&#39;Mix_GeneRuler&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sizes&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span>
                     <span class="mi">1500</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span>
                     <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;bp&#39;</span><span class="p">),</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.032</span><span class="p">,</span>
                       <span class="mf">0.032</span><span class="p">,</span> <span class="mf">0.032</span><span class="p">,</span> <span class="mf">0.032</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.034</span><span class="p">,</span> <span class="mf">0.034</span><span class="p">,</span> <span class="mf">0.034</span><span class="p">,</span> <span class="mf">0.034</span><span class="p">,</span>
                       <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">])</span>
        <span class="p">},</span>
    <span class="s1">&#39;High_Range_GeneRuler&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sizes&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">48502</span><span class="p">,</span> <span class="mi">24508</span><span class="p">,</span> <span class="mi">20555</span><span class="p">,</span> <span class="mi">17000</span><span class="p">,</span> <span class="mi">15258</span><span class="p">,</span> <span class="mi">13825</span><span class="p">,</span> <span class="mi">12119</span><span class="p">,</span> <span class="mi">10171</span><span class="p">],</span>
                    <span class="s1">&#39;bp&#39;</span><span class="p">),</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">:</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.176</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.118</span><span class="p">,</span> <span class="mf">0.118</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">,</span> <span class="mf">0.074</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">}</span>


<span class="c1"># Data</span>
<span class="n">hor_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">+------+-----+-------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">|  E   | %T  | L_max | L_min | mu_S*10^8 | mu_L*10^8 |   gamma  |  chi^2 | L&#39;max | chi^2&#39; |</span>
<span class="s1">|(V/cm)|     | (bp)  | (bp)  |(m^2/V.sec)|(m^2/V.sec)|   (kbp)  |        | (bp)  |        |</span>
<span class="s1">+------+-----+-------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">| 0.71 | 0.5 | 35000 | 1000  |    2.61   |    0.42   |   29.70  | 0.9999 |       |        |</span>
<span class="s1">| 0.71 | 1.0 | 20000 |  300  |    2.54   |  1.64E-07 | 2.81E+07 | 0.9981 |  5000 | 0.9992 |</span>
<span class="s1">| 0.71 | 1.3 | 20000 |  200  |    2.49   |  2.60E-09 | 1.06E+09 | 0.9647 |  2600 | 0.9990 |</span>
<span class="s1">| 1.00 | 1.0 | 48502 |  400  |    2.37   |    0.23   |   29.99  | 0.9997 |       |        |</span>
<span class="s1">| 1.00 | 1.1 | 30000 |  200  |    2.21   |    0.05   |   74.08  | 0.9987 | 25000 | 0.9991 |</span>
<span class="s1">| 1.00 | 1.2 | 27500 |  200  |    2.14   |    0.01   |  144.40  | 0.9964 |  1300 | 0.9990 |</span>
<span class="s1">| 1.23 | 0.7 | 47500 | 1000  |    2.60   |    0.66   |   19.86  | 0.9997 |       |        |</span>
<span class="s1">| 1.23 | 0.8 | 35000 |  200  |    2.55   |    0.23   |   23.84  | 0.9988 | 27500 | 0.9990 |</span>
<span class="s1">| 1.23 | 0.9 | 25000 |  200  |    2.44   |    0.08   |   49.58  | 0.9971 |  3000 | 0.9992 |</span>
<span class="s1">| 1.31 | 0.5 | 35000 |  400  |    2.54   |    0.39   |   19.69  | 0.9999 |       |        |</span>
<span class="s1">| 1.31 | 1.0 | 25000 |  200  |    2.52   |    0.15   |   25.75  | 0.9986 | 17500 | 0.9992 |</span>
<span class="s1">| 1.31 | 1.3 | 48502 |  200  |    2.48   |    0.05   |   46.75  | 0.9967 | 14000 | 0.9991 |</span>
<span class="s1">| 1.51 | 1.0 | 35000 |  200  |    2.24   |    0.29   |   17.86  | 0.9997 |       |        |</span>
<span class="s1">| 1.51 | 1.1 | 32500 |  300  |    2.26   |    0.14   |   23.78  | 0.9980 | 20000 | 0.9989 |</span>
<span class="s1">| 1.51 | 1.2 | 48502 |  200  |    2.17   |    0.04   |   64.31  | 0.9974 | 15000 | 0.9991 |</span>
<span class="s1">| 1.80 | 0.5 | 47500 |  300  |    2.48   |    0.51   |   17.23  | 0.9998 |       |        |</span>
<span class="s1">| 1.80 | 1.3 | 30000 |  200  |    2.39   |    0.22   |   11.93  | 0.9980 | 13000 | 0.9991 |</span>
<span class="s1">| 2.00 | 1.0 | 48502 |  200  |    2.22   |    0.23   |   13.96  | 0.9982 | 20000 | 0.9992 |</span>
<span class="s1">| 2.00 | 1.1 | 48502 |  200  |    2.24   |    0.16   |   13.06  | 0.9971 | 10000 | 0.9991 |</span>
<span class="s1">| 2.00 | 1.2 | 17500 |  200  |    2.15   |    0.07   |   30.99  | 0.9979 | 10000 | 0.9990 |</span>
<span class="s1">| 2.22 | 0.5 | 35000 |  300  |    2.68   |    0.65   |   12.90  | 0.9995 |       |        |</span>
<span class="s1">| 2.22 | 1.0 | 35000 |  200  |    2.64   |    0.43   |    9.56  | 0.9994 |       |        |</span>
<span class="s1">| 2.22 | 1.3 | 32500 |  200  |    2.56   |    0.29   |    8.42  | 0.9981 | 17500 | 0.9991 |</span>
<span class="s1">| 2.47 | 0.7 | 32500 |  200  |    2.59   |    0.51   |    9.50  | 0.9997 |       |        |</span>
<span class="s1">| 2.47 | 0.8 | 35000 |  500  |    2.64   |    0.47   |    8.77  | 0.9998 |       |        |</span>
<span class="s1">| 2.47 | 0.9 | 48502 |  200  |    2.57   |    0.39   |    8.98  | 0.9992 |       |        |</span>
<span class="s1">| 2.51 | 0.7 | 35000 |  200  |    2.44   |    0.45   |   14.19  | 0.9999 |       |        |</span>
<span class="s1">| 2.51 | 0.8 | 35000 |  200  |    2.44   |    0.39   |   12.41  | 0.9996 |       |        |</span>
<span class="s1">| 2.51 | 0.9 | 48502 |  200  |    2.43   |    0.27   |   11.03  | 0.9986 | 15000 | 0.9991 |</span>
<span class="s1">| 2.78 | 0.5 | 10000 |  200  |    3.32   |    0.92   |    9.30  | 0.9999 |       |        |</span>
<span class="s1">| 2.78 | 0.6 | 10000 |  200  |    3.25   |    0.80   |    8.47  | 1.0000 |       |        |</span>
<span class="s1">| 2.78 | 0.7 | 10000 |  200  |    3.18   |    0.66   |    9.80  | 0.9998 |       |        |</span>
<span class="s1">| 2.78 | 0.8 | 10000 |  200  |    3.06   |    0.55   |    9.84  | 0.9997 |       |        |</span>
<span class="s1">| 2.78 | 0.9 | 10000 |  200  |    2.93   |    0.46   |    9.64  | 0.9997 |       |        |</span>
<span class="s1">| 2.78 | 1.0 | 10000 |  200  |    2.93   |    0.39   |   10.40  | 0.9997 |       |        |</span>
<span class="s1">| 2.78 | 1.1 | 10000 |  200  |    2.93   |    0.33   |   10.35  | 0.9993 |       |        |</span>
<span class="s1">| 2.78 | 1.2 | 10000 |  200  |    2.85   |    0.30   |   10.82  | 0.9995 |       |        |</span>
<span class="s1">| 2.78 | 1.3 | 10000 |  200  |    2.84   |    0.25   |   11.14  | 0.9996 |       |        |</span>
<span class="s1">| 2.78 | 1.4 | 10000 |  200  |    2.79   |    0.22   |   11.52  | 0.9994 |       |        |</span>
<span class="s1">| 2.78 | 1.5 | 10000 |  200  |    2.70   |    0.19   |   11.63  | 0.9993 |       |        |</span>
<span class="s1">| 3.10 | 1.0 | 32500 |  200  |    2.65   |    0.58   |    8.61  | 0.9999 |       |        |</span>
<span class="s1">| 3.10 | 1.1 | 30000 |  200  |    2.62   |    0.55   |    7.99  | 0.9998 |       |        |</span>
<span class="s1">| 3.10 | 1.2 | 27500 |  200  |    2.56   |    0.33   |    6.06  | 0.9980 |  5000 | 0.9994 |</span>
<span class="s1">| 3.51 | 0.5 | 35000 |  900  |    2.58   |    0.75   |   13.34  | 0.9993 |       |        |</span>
<span class="s1">| 3.51 | 1.0 | 48502 |  200  |    2.58   |    0.52   |    6.82  | 0.9997 |       |        |</span>
<span class="s1">| 3.51 | 1.3 | 25000 |  200  |    2.51   |    0.38   |    6.05  | 0.9989 |  8000 | 0.9990 |</span>
<span class="s1">| 5.00 | 0.5 | 22500 | 1000  |    2.53   |    0.75   |   18.15  | 0.9996 |       |        |</span>
<span class="s1">| 5.00 | 1.0 | 20000 |  400  |    2.55   |    0.67   |    5.78  | 0.9995 |       |        |</span>
<span class="s1">| 5.00 | 1.3 | 17500 |  200  |    2.51   |    0.50   |    4.22  | 0.9995 |       |        |</span>
<span class="s1">+------+-----+-------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">ver_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">+------+-----+--------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">|  E   | %T  | L_max  | L_min | mu_S*10^8 | mu_L*10^8 |   gamma  |  chi^2 | L&#39;max | chi^2&#39; |</span>
<span class="s1">|(V/cm)|     |  (bp)  | (bp)  |(m^2/V.sec)|(m^2/V.sec)|   (kbp)  |        | (bp)  |        |</span>
<span class="s1">+------+-----+--------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">| 0.62 | 0.4 |  48502 | 1000  |    2.67   |    0.21   |  52.799  | 0.9993 |       |        |</span>
<span class="s1">| 0.93 | 0.4 | 194000 | 1000  |    2.54   |    0.34   |  25.304  | 0.9992 |       |        |</span>
<span class="s1">| 1.24 | 0.4 |  48502 |  200  |    3.67   |    0.81   |  14.922  | 0.9997 |       |        |</span>
<span class="s1">| 1.55 | 0.4 | 194000 |  200  |    3.18   |    0.77   |  14.488  | 0.9992 |       |        |</span>
<span class="s1">| 1.86 | 0.4 | 194000 |  200  |    3.12   |    0.78   |  12.603  | 0.9990 |       |        |</span>
<span class="s1">| 2.17 | 0.4 | 194000 |  200  |    3.07   |    0.89   |  11.911  | 0.9971 | 17500 | 0.9992 |</span>
<span class="s1">| 2.48 | 0.4 | 194000 |  200  |    3.13   |    0.90   |  12.648  | 0.9979 | 15000 | 0.9991 |</span>
<span class="s1">| 3.10 | 0.4 | 194000 |  200  |    3.14   |    0.98   |   9.423  | 0.9964 | 12000 | 0.9991 |</span>
<span class="s1">| 4.97 | 0.4 | 194000 |  200  |    3.34   |    1.22   |   9.630  | 0.9983 |  8000 | 0.9990 |</span>
<span class="s1">| 6.21 | 0.4 | 194000 |  200  |    3.11   |    1.20   |   9.214  | 0.9959 |  4400 | 0.9993 |</span>
<span class="s1">| 0.62 | 0.7 |  48502 |  200  |    2.86   |  8.36E-06 | 7.32E+05 | 0.9973 |  2700 | 0.9990 |</span>
<span class="s1">| 0.93 | 0.7 | 194000 |  200  |    2.38   |    0.09   |  54.264  | 0.9968 | 25000 | 0.9990 |</span>
<span class="s1">| 1.24 | 0.7 |  48502 |  200  |    3.71   |    0.49   |  15.255  | 0.9993 |       |        |</span>
<span class="s1">| 1.55 | 0.7 | 194000 |  200  |    3.61   |    0.53   |  13.125  | 0.9994 |       |        |</span>
<span class="s1">| 1.86 | 0.7 |  47500 |  300  |    3.61   |    0.62   |   9.834  | 0.9997 |       |        |</span>
<span class="s1">| 2.17 | 0.7 | 194000 |  200  |    3.07   |    0.55   |  10.151  | 0.9998 |       |        |</span>
<span class="s1">| 2.48 | 0.7 | 194000 |  200  |    3.42   |    0.72   |   9.036  | 0.9997 |       |        |</span>
<span class="s1">| 3.10 | 0.7 | 194000 |  200  |    3.14   |    0.69   |   7.713  | 0.9996 |       |        |</span>
<span class="s1">| 4.97 | 0.7 | 194000 |  200  |    3.08   |    0.93   |   6.188  | 0.9984 | 15000 | 0.9990 |</span>
<span class="s1">| 6.21 | 0.7 | 194000 |  200  |    3.24   |    1.03   |   6.371  | 0.9987 | 10000 | 0.9991 |</span>
<span class="s1">| 0.62 | 1.0 |  48502 |  200  |    2.48   |  1.82E-14 | 1.83E+14 | 0.9938 |  2900 | 0.9990 |</span>
<span class="s1">| 0.93 | 1.0 | 194000 |  300  |    2.41   |  1.37E-13 | 2.33E+13 | 0.9947 |  2900 | 0.9990 |</span>
<span class="s1">| 1.24 | 1.0 |  48502 |  200  |    3.34   |    0.17   |  25.855  | 0.9974 | 14000 | 0.9990 |</span>
<span class="s1">| 1.55 | 1.0 |  47500 |  200  |    3.25   |    0.33   |  12.773  | 0.9977 | 14000 | 0.9990 |</span>
<span class="s1">| 1.86 | 1.0 |  47500 |  400  |    3.69   |    0.47   |   8.502  | 0.9984 | 10000 | 0.9991 |</span>
<span class="s1">| 2.17 | 1.0 | 194000 |  200  |    2.87   |    0.38   |   9.372  | 0.9989 | 15000 | 0.9990 |</span>
<span class="s1">| 2.48 | 1.0 | 194000 |  200  |    3.39   |    0.52   |   7.209  | 0.9990 |       |        |</span>
<span class="s1">| 3.10 | 1.0 |  19400 |  300  |    3.36   |    0.61   |   5.852  | 0.9994 |       |        |</span>
<span class="s1">| 4.97 | 1.0 |  48502 |  200  |    3.04   |    0.77   |   4.749  | 0.9989 | 48502 | 0.9991 |</span>
<span class="s1">| 6.21 | 1.0 | 194000 |  200  |    3.13   |    0.88   |   4.417  | 0.9975 | 12500 | 0.9991 |</span>
<span class="s1">| 0.62 | 1.3 |  48502 |  200  |    2.12   |  1.87E-10 | 1.11E+10 | 0.9904 |  1800 | 0.9991 |</span>
<span class="s1">| 0.93 | 1.3 | 194000 |  300  |    1.96   |  3.80E-06 | 6.10E+05 | 0.9928 |  2600 | 0.9992 |</span>
<span class="s1">| 1.24 | 1.3 |  48502 |  300  |    3.32   |    0.02   | 179.189  | 0.9967 |  2600 | 0.9991 |</span>
<span class="s1">| 1.55 | 1.3 | 194000 |  200  |    3.47   |    0.27   |  11.920  | 0.9958 |  9000 | 0.9990 |</span>
<span class="s1">| 1.86 | 1.3 |  47500 |  400  |    3.97   |    0.36   |   8.594  | 0.9970 |  7000 | 0.9991 |</span>
<span class="s1">| 2.17 | 1.3 | 194000 |  200  |    2.76   |    0.21   |  12.412  | 0.9966 | 10000 | 0.9990 |</span>
<span class="s1">| 2.48 | 1.3 | 194000 |  200  |    3.26   |    0.45   |   7.464  | 0.9985 | 11000 | 0.9990 |</span>
<span class="s1">| 3.10 | 1.3 |  47500 |  200  |    3.37   |    0.50   |   5.159  | 0.9984 |  6000 | 0.9992 |</span>
<span class="s1">| 4.97 | 1.3 |  48502 |  200  |    2.68   |    0.49   |   4.048  | 0.9983 |  4000 | 0.9993 |</span>
<span class="s1">| 6.21 | 1.3 | 194000 |  200  |    2.70   |    0.59   |   3.555  | 0.9991 |       |        |</span>
<span class="s1">+------+-----+--------+-------+-----------+-----------+----------+--------+-------+--------+</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># Strings of data as text files</span>
<span class="n">data_as_file</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="n">_BytesIO</span><span class="p">(</span><span class="n">hor_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">|&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
                <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="n">_BytesIO</span><span class="p">(</span><span class="n">ver_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">|&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="p">}</span>

<span class="c1"># Load data into numpy arrays</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_as_file</span><span class="p">:</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data_source</span> <span class="o">=</span> <span class="n">data_as_file</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">temp_dset</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">skip_header</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">skip_footer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                              <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;muS&#39;</span><span class="p">,</span> <span class="s1">&#39;muL&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">))</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dset</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;V/cm&#39;</span><span class="p">)</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dset</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">)</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;muS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dset</span><span class="p">[</span><span class="s1">&#39;muS&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;1.0E-8 m**2/(V*s)&#39;</span><span class="p">)</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;muL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dset</span><span class="p">[</span><span class="s1">&#39;muL&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;1.0E-8 m**2/(V*s)&#39;</span><span class="p">)</span>
    <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dset</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;kbp&#39;</span><span class="p">)</span>


<span class="c1"># vWBR equation</span>
<div class="viewcode-block" id="vWBR"><a class="viewcode-back" href="../../index.html#pydna.gel.vWBR">[docs]</a><span class="k">def</span> <span class="nf">vWBR</span><span class="p">(</span><span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;vWBR equation&quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">muL</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">muS</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">muS</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">beta</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">gamma</span><span class="p">)))</span></div>

<span class="c1"># Mobility function: mu(L) = f(muS, muL, gamma)</span>
<span class="n">mu_funcs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
    <span class="n">mu_funcs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vWBR</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;muS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">),</span>
                          <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;muL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">),</span>
                          <span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;bp&#39;</span><span class="p">)</span>
                          <span class="p">)</span>


<span class="c1"># Constants</span>
<span class="n">kB</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">boltzmann_constant</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m**2 * kg / s**2 / K&#39;</span><span class="p">)</span>  <span class="c1"># Boltzmann constant</span>
<span class="n">lp</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>  <span class="c1"># persistence length of dsDNA (nm)</span>
<span class="n">l</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lp</span>            <span class="c1"># Kuhn length (nm)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.34</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;nm/bp&#39;</span><span class="p">)</span>  <span class="c1"># curvilinear length dsDNA (nm/bp)</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;A*s&#39;</span><span class="p">)</span>  <span class="c1"># elementary charge (1.602176565E-19 A.s)</span>
<span class="n">qeff</span> <span class="o">=</span> <span class="n">e</span><span class="o">/</span><span class="n">Q_</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">)</span>  <span class="c1"># effective charge per dsDNA base pair (A.s/bp)</span>
<span class="n">constants</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kB&#39;</span><span class="p">:</span> <span class="n">kB</span><span class="p">,</span> <span class="s1">&#39;lp&#39;</span><span class="p">:</span> <span class="n">lp</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="n">l</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;qeff&#39;</span><span class="p">:</span> <span class="n">qeff</span><span class="p">}</span>

<span class="c1"># mobility = distance/(time*field)</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">distance</span><span class="p">,</span> <span class="n">mobility</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">distance</span><span class="o">/</span><span class="p">(</span><span class="n">mobility</span><span class="o">*</span><span class="n">field</span><span class="p">)</span>

<span class="n">rundistance</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">time</span><span class="p">,</span> <span class="n">mobility</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">time</span><span class="o">*</span><span class="n">mobility</span><span class="o">*</span><span class="n">field</span>

<span class="c1"># Intrinsic band broadening as function of the diffusion coefficient and time</span>
<span class="n">bandbroadening</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">D</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">time</span><span class="p">)</span>

<span class="n">pore_size</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">gamma</span><span class="o">*</span><span class="n">muL</span><span class="o">*</span><span class="n">lp</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="n">mu0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pore_size_fit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">C</span><span class="p">:</span> <span class="mi">143</span><span class="o">*</span><span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;nm*g**0.59/mL**0.59&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.59</span><span class="p">)</span>

<span class="n">radius_gyration</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">,</span> <span class="n">lp</span><span class="p">:</span> <span class="p">(</span><span class="n">lp</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lp</span><span class="o">/</span><span class="n">L</span><span class="o">+</span><span class="n">lp</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">lp</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="n">H2Oviscosity</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">T</span><span class="p">:</span> <span class="mf">2.414E-5</span><span class="o">*</span><span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;kg/m/s&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">247.8</span><span class="o">*</span><span class="n">ureg</span><span class="o">.</span><span class="n">K</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">140</span><span class="o">*</span><span class="n">ureg</span><span class="o">.</span><span class="n">K</span><span class="p">))</span>  <span class="c1"># (Pa.s)=(kg/(m.s)) accurate to within 2.5% from 0 ¬∞C to 370 ¬∞C</span>

<span class="n">contour_length</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Nbp</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Nbp</span><span class="o">*</span><span class="n">b</span>

<span class="n">reduced_field</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">eta</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">eta</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mu0</span><span class="o">*</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>

<span class="n">reduced_field_Kuhn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">eta</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">eta</span><span class="o">*</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mu0</span><span class="o">*</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Diffusion coefficient of a blob</span>
<span class="n">Dblob</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># Diffusion coefficient of a Kuhn segment</span>
<span class="n">DKuhn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">l</span><span class="p">)</span>

<span class="c1"># Relations between basepairs (Nbp), Kuhn segments (NKuhn) and blobs (N)</span>
<span class="n">Nbp_to_NKuhn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Nbp</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Nbp</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="n">l</span>  <span class="c1"># number of Kuhn segments (~= Nbp/300)</span>
<span class="n">NKuhn_to_Nbp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">NKuhn</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">NKuhn</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="n">b</span>  <span class="c1"># number of base pairs (bp)</span>
<span class="n">NKuhn_to_N</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">NKuhn</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">NKuhn</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># number of occupied pores</span>
<span class="n">N_to_NKuhn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># number of Kuhn segments</span>
<span class="n">N_to_Nbp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># number of base pairs (bp)</span>
<span class="n">Nbp_to_N</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Nbp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Nbp</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># number of occupied pores</span>

<span class="c1"># Individual diffusion regimes</span>
<span class="n">reptation_equilibrium</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Dblob</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="n">Dblob</span><span class="o">/</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span>
<span class="n">reptation_accelerated</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Dblob</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="n">Dblob</span><span class="o">*</span><span class="n">epsilon</span><span class="o">*</span><span class="n">N</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">reptation_plateau</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Dblob</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">Dblob</span><span class="o">*</span><span class="n">epsilon</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">free_solution</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Rh</span><span class="p">:</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span><span class="o">*</span><span class="n">Rh</span><span class="p">)</span>
<span class="n">Zimm_g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Nbp</span><span class="p">,</span> <span class="n">DRouse</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">DRouse</span><span class="o">*</span><span class="n">Nbp</span><span class="o">*</span><span class="n">qeff</span><span class="o">/</span><span class="p">(</span><span class="n">mu0</span><span class="o">*</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>
<span class="n">Ogston_Zimm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">D0</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">D0</span> <span class="o">*</span> <span class="n">g</span>
<span class="n">Ogston_Rouse</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">Nbp</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">Nbp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Diffusion regime frontiers (in number of occupied pores)</span>
<span class="n">Zimm_Rouse</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">Nbp_to_N</span><span class="p">(</span><span class="n">_fsolve</span><span class="p">(</span><span class="n">diff_Zimm_Rouse</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">bp</span><span class="p">,</span>
             <span class="n">args</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
<span class="n">equil_accel</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">accel_plateau</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="diff_Zimm_Rouse"><a class="viewcode-back" href="../../index.html#pydna.gel.diff_Zimm_Rouse">[docs]</a><span class="k">def</span> <span class="nf">diff_Zimm_Rouse</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">Nbp</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">Nbp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;bp&#39;</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">contour_length</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">Rg</span> <span class="o">=</span> <span class="n">radius_gyration</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span>
    <span class="n">D0</span> <span class="o">=</span> <span class="n">free_solution</span><span class="p">(</span><span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Rg</span><span class="p">)</span>
    <span class="n">DRouse</span> <span class="o">=</span> <span class="n">Ogston_Rouse</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Zimm_g</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">DRouse</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">to_base_units</span><span class="p">()</span>
    <span class="n">DZimm</span> <span class="o">=</span> <span class="n">Ogston_Zimm</span><span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="c1">#    print &#39;Nbp =\t&#39;, Nbp</span>
<span class="c1">#    print &#39;kB =\t&#39;, kB</span>
<span class="c1">#    print &#39;T =\t&#39;, T</span>
<span class="c1">#    print &#39;qeff =\t&#39;, qeff</span>
<span class="c1">#    print &#39;eta =\t&#39;, eta</span>
<span class="c1">#    print &#39;mu0 =\t&#39;, mu0</span>
<span class="c1">#    print &#39;a =\t&#39;, a</span>
<span class="c1">#    print &#39;b =\t&#39;, b</span>
<span class="c1">#    print &#39;l =\t&#39;, l</span>
<span class="c1">#    print &#39;lp =\t&#39;, lp</span>
<span class="c1">#    print &#39;L =\t&#39;, L</span>
<span class="c1">#    print &#39;Rg =\t&#39;, Rg</span>
<span class="c1">#    print &#39;D0 =\t&#39;, D0</span>
<span class="c1">#    print &#39;DRouse =\t&#39;, DRouse</span>
<span class="c1">#    print &#39;g =\t&#39;, g</span>
<span class="c1">#    print &#39;DZimm =\t&#39;, DZimm</span>
<span class="c1">#    print &#39;DZimm - DRouse =\t&#39;, DZimm - DRouse</span>
<span class="c1">#    print 70*&#39;#&#39;</span>
    <span class="k">return</span> <span class="n">DZimm</span> <span class="o">-</span> <span class="n">DRouse</span></div>


<span class="c1"># Diffusion coefficient</span>
<div class="viewcode-block" id="diffusion_coefficient"><a class="viewcode-back" href="../../index.html#pydna.gel.diffusion_coefficient">[docs]</a><span class="k">def</span> <span class="nf">diffusion_coefficient</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">N_lim1</span><span class="p">,</span> <span class="n">N_lim2</span><span class="p">,</span> <span class="n">N_lim3</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">Nbp_to_N</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="n">N_lim3</span><span class="p">:</span>
        <span class="c1"># Ogston-Zimm</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">contour_length</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">Rg</span> <span class="o">=</span> <span class="n">radius_gyration</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span>
        <span class="n">D0</span> <span class="o">=</span> <span class="n">free_solution</span><span class="p">(</span><span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Rg</span><span class="p">)</span>
        <span class="n">DRouse</span> <span class="o">=</span> <span class="n">Ogston_Rouse</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Zimm_g</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">DRouse</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Ogston_Zimm</span><span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="n">N_lim2</span><span class="p">:</span>
        <span class="c1"># Rouse/Reptation-equilibrium</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">/</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="n">N_lim1</span><span class="p">:</span>
        <span class="c1"># Reptation-plateau (reptation with orientation)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">*</span><span class="n">epsilon</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Accelerated-reptation</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">*</span><span class="n">epsilon</span><span class="o">*</span><span class="n">N</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">D</span></div>


<span class="c1">#def rand_str(sample, length):</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    Return a random string of given length built from the chars in sample.</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    rnd_str = &#39;&#39;</span>
<span class="c1">#    for i in xrange(length):</span>
<span class="c1">#        r = randint(0, len(sample)-1)</span>
<span class="c1">#        rnd_str += sample[r]</span>
<span class="c1">#    return rnd_str</span>


<div class="viewcode-block" id="random_Dseqs"><a class="viewcode-back" href="../../index.html#pydna.gel.random_Dseqs">[docs]</a><span class="k">def</span> <span class="nf">random_Dseqs</span><span class="p">(</span><span class="n">sizes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of pydna Dseqs of given sizes and random sequences.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">_Dseq</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="o">*</span><span class="n">size</span><span class="p">)</span> <span class="c1">#_Dseq(rand_str(&#39;actg&#39;, size))</span>
        <span class="n">sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sample</span></div>



<div class="viewcode-block" id="Fakeseq"><a class="viewcode-back" href="../../index.html#pydna.gel.Fakeseq">[docs]</a><span class="k">class</span> <span class="nc">Fakeseq</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">10E-12</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span></div>


<div class="viewcode-block" id="gen_sample"><a class="viewcode-back" href="../../index.html#pydna.gel.gen_sample">[docs]</a><span class="k">def</span> <span class="nf">gen_sample</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">quantities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return list of pydna Dseqrecords of given size and quantity.</span>

<span class="sd">    If a single quantity is given it is divided by the DNA fragments</span>
<span class="sd">    in proportion to their length.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    sizes : iterable of pint.unit.Quantity objects or ints</span>
<span class="sd">        List of DNA sizes in base pairs (bp).</span>

<span class="sd">    quantities : iterable of pint.unit.Quantity objects, floats or ints</span>
<span class="sd">        List of DNA weights in nanograms (ng).</span>
<span class="sd">        If a single quantity is given (pint.unit.Quantity object, float</span>
<span class="sd">        or int) it is divided linearly by the DNA fragments length.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Direct quantity assignment without declared units.</span>

<span class="sd">    &gt;&gt;&gt; sizes = [3000, 500, 1500]  # bp</span>
<span class="sd">    &gt;&gt;&gt; qts = [70.0, 11.7, 35.0]  # ng</span>
<span class="sd">    &gt;&gt;&gt; sample = gen_sample(sizes, qts)</span>
<span class="sd">    &gt;&gt;&gt; sample</span>
<span class="sd">    [Dseqrecord(-3000), Dseqrecord(-500), Dseqrecord(-1500)]</span>
<span class="sd">    &gt;&gt;&gt; float(&quot;{0:.2f}&quot;.format(sample[0].m() * 1E6))  # ¬µg</span>
<span class="sd">    0.07</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.m() for dna in sample], &#39;g&#39;).to(&#39;ng&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([70.  11.7 35. ], &#39;nanogram&#39;)&gt;</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.n for dna in sample], &#39;mol&#39;).to(&#39;pmol&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([0.03776682 0.03786665 0.03776521], &#39;picomole&#39;)&gt;</span>

<span class="sd">    Direct quantity assignment with declared units.</span>

<span class="sd">    &gt;&gt;&gt; sizes = Q_([3000, 500, 1500], &#39;bp&#39;)</span>
<span class="sd">    &gt;&gt;&gt; qts = Q_([70.0, 11.7, 35.0],  &#39;ng&#39;) </span>
<span class="sd">    &gt;&gt;&gt; sample = gen_sample(sizes, qts)</span>
<span class="sd">    &gt;&gt;&gt; sample</span>
<span class="sd">    [Dseqrecord(-3000), Dseqrecord(-500), Dseqrecord(-1500)]</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.m() for dna in sample], &#39;g&#39;).to(&#39;ng&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([70.  11.7 35. ], &#39;nanogram&#39;)&gt;</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.n for dna in sample], &#39;mol&#39;).to(&#39;pmol&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([0.03776682 0.03786665 0.03776521], &#39;picomole&#39;)&gt;</span>

<span class="sd">    Assignment of total quantity (with declared units).</span>

<span class="sd">    &gt;&gt;&gt; sample = gen_sample(Q_([3000, 500, 1500], &#39;bp&#39;), Q_(200, &#39;ng&#39;))</span>
<span class="sd">    &gt;&gt;&gt; sample</span>
<span class="sd">    [Dseqrecord(-3000), Dseqrecord(-500), Dseqrecord(-1500)]</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.m() for dna in sample], &#39;g&#39;).to(&#39;ng&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([120.  20.  60.], &#39;nanogram&#39;)&gt;</span>
<span class="sd">    &gt;&gt;&gt; Q_([dna.n for dna in sample], &#39;mol&#39;).to(&#39;pmol&#39;) # doctest: +SKIP</span>
<span class="sd">    &lt;Quantity([0.06474311 0.06472932 0.06474035], &#39;picomole&#39;)&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frags</span> <span class="o">=</span> <span class="n">random_Dseqs</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">to_units</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">)])</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">)</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="n">quantities</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="n">quantities</span> <span class="o">=</span> <span class="n">lin_div_Qty</span><span class="p">(</span><span class="n">frags</span><span class="p">,</span> <span class="n">quantities</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_Dseqrecord</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">quantities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">seq</span><span class="o">.</span><span class="n">mw</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span>
            <span class="nb">enumerate</span><span class="p">(</span><span class="n">frags</span><span class="p">)]</span></div>


<div class="viewcode-block" id="weight_standard_sample"><a class="viewcode-back" href="../../index.html#pydna.gel.weight_standard_sample">[docs]</a><span class="k">def</span> <span class="nf">weight_standard_sample</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">qty</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">)):</span>
    <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weight_standards</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Key not recognized. Choose from: </span><span class="si">%s</span><span class="s2">&quot;</span>
                                     <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">weight_standards</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">qty</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">qty</span><span class="p">,</span> <span class="n">Vars</span><span class="p">[</span><span class="s1">&#39;quantities&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;qty&#39;</span><span class="p">)</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="n">weight_standards</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;sizes&#39;</span><span class="p">]</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="n">weight_standards</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="n">qty</span> <span class="o">*</span> <span class="n">fracs</span>
    <span class="k">return</span> <span class="n">gen_sample</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">quantities</span><span class="p">)</span></div>


<div class="viewcode-block" id="logspace_int"><a class="viewcode-back" href="../../index.html#pydna.gel.logspace_int">[docs]</a><span class="k">def</span> <span class="nf">logspace_int</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">divs</span><span class="p">):</span>
    <span class="n">space</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span> <span class="n">divs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">space</span><span class="p">])</span></div>


<div class="viewcode-block" id="flatten"><a class="viewcode-back" href="../../index.html#pydna.gel.flatten">[docs]</a><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">List</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="n">List</span>
    <span class="n">flatL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">List</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">Q_</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">flatE</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="p">[</span><span class="n">flatL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">flatE</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flatL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flatL</span></div>

<span class="c1"># Gaussian function</span>
<span class="n">Gaussian</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">hgt</span><span class="p">,</span> <span class="n">ctr</span><span class="p">,</span> <span class="n">dev</span><span class="p">:</span> <span class="n">hgt</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">ctr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">Gauss_hgt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">auc</span><span class="p">,</span> <span class="n">dev</span><span class="p">:</span> <span class="n">auc</span><span class="o">/</span><span class="p">(</span><span class="n">dev</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="n">Gauss_dev</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">FWHM</span><span class="p">:</span> <span class="n">FWHM</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="c1"># Gauss_dev = lambda FWTM: FWTM/(2*_np.sqrt(2*_np.log(10)))</span>
<span class="n">Gauss_FWHM</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">FWTM</span><span class="p">:</span> <span class="n">FWTM</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_to_units</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Asserts that the quantity has the proper dimensions</span>
<span class="sd">    (inferred from the default units) if the quantity is an instance of</span>
<span class="sd">    pint.unit.Quantity or assigns the default units if it&#39;s not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">Q_</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantity</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var_name</span><span class="p">:</span>
                <span class="n">error</span><span class="o">.</span><span class="n">extra_msg</span> <span class="o">=</span> <span class="s2">&quot; for variable &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">var_name</span>
            <span class="k">raise</span> <span class="n">error</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quantity</span>


<div class="viewcode-block" id="to_units"><a class="viewcode-back" href="../../index.html#pydna.gel.to_units">[docs]</a><span class="k">def</span> <span class="nf">to_units</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Asserts that the quantity has the proper dimensions</span>
<span class="sd">    (inferred from the default units) if the quantity is an instance of</span>
<span class="sd">    pint.unit.Quantity or assigns the default units if it&#39;s not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">Q_</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
            <span class="nb">sum</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">Q_</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">quantity</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">temp_qty</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_units</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantity</span><span class="p">]</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">temp_qty</span><span class="p">],</span> <span class="n">units</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">_to_units</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quantity</span></div>


<div class="viewcode-block" id="dim_or_units"><a class="viewcode-back" href="../../index.html#pydna.gel.dim_or_units">[docs]</a><span class="k">def</span> <span class="nf">dim_or_units</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">reference</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If &lt;quantity&gt; is not an instance of &lt;Quantity&gt;, instantiate a &lt;Quantity&gt;</span>
<span class="sd">    object with &lt;quantity&gt; as magnitude and as &lt;reference.units&gt; as units.</span>
<span class="sd">    If &lt;quantity&gt; is an instance of &lt;Quantity&gt;, check whether it has the same</span>
<span class="sd">    dimensionality as &lt;reference&gt;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">Q_</span><span class="p">):</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">quantity</span><span class="o">.</span><span class="n">dimensionality</span> <span class="o">==</span> <span class="n">reference</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Dimension mismatch: (</span><span class="si">%s</span><span class="s2">) != (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">quantity</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">,</span>
                                                  <span class="n">reference</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">quantity</span></div>

<div class="viewcode-block" id="assign_quantitiesB"><a class="viewcode-back" href="../../index.html#pydna.gel.assign_quantitiesB">[docs]</a><span class="k">def</span> <span class="nf">assign_quantitiesB</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">maxdef</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns quantities (masses in nanograms) to the DNA fragments without</span>
<span class="sd">    corresponding quantity assuming a linear relationship between the DNA</span>
<span class="sd">    length (in basepairs) and its mass. As if the fragments originated in</span>
<span class="sd">    a restriction procedure.</span>
<span class="sd">    For each sample takes the maximum quantity (either from the other samples</span>
<span class="sd">    or from the default) and assigns it to the fragment with greater length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">[</span><span class="s1">&#39;quantities&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
    <span class="n">maxQ</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="c1"># Preprocessing and straightforward cases</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">sample_qts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qty</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">quantities</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">qty</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span> <span class="ow">and</span> <span class="n">qty</span><span class="o">.</span><span class="n">magnitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sample_qts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qty</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">qty</span> <span class="o">&gt;</span> <span class="n">maxQ</span><span class="p">:</span>
                    <span class="n">maxQ</span> <span class="o">=</span> <span class="n">qty</span>
        <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_qts</span><span class="p">)</span>
    <span class="c1"># Quantity assignment - missing values</span>
    <span class="k">if</span> <span class="n">maxQ</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">maxQ</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">maxdef</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="s1">&#39;maxdef&#39;</span><span class="p">)</span>
    <span class="n">maxQ</span> <span class="o">=</span> <span class="n">maxQ</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">quantities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c1"># Linearly extrapolates each DNA fragment&#39;s quantity taking as</span>
            <span class="c1"># reference the maximum quantity registered (or the default)</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dna</span><span class="p">)</span> <span class="k">for</span> <span class="n">dna</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">solutes</span><span class="p">]</span>
            <span class="n">maxL</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
            <span class="n">quantities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="o">*</span><span class="n">maxQ</span><span class="o">/</span><span class="n">maxL</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="s1">&#39;quantities&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quantities</span></div>


<div class="viewcode-block" id="lin_div_Qty"><a class="viewcode-back" href="../../index.html#pydna.gel.lin_div_Qty">[docs]</a><span class="k">def</span> <span class="nf">lin_div_Qty</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linearly divides a quantity by the elements of sample considering a</span>
<span class="sd">    criteria. Criteria must by a function that returns a number upon being</span>
<span class="sd">    applied to each element of sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">criteria</span><span class="p">(</span><span class="n">dna</span><span class="p">)</span> <span class="k">for</span> <span class="n">dna</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">size</span><span class="o">*</span><span class="n">quantity</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">size_to_mobility</span><span class="p">(</span><span class="n">dna_len</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span>
                     <span class="n">mu_func</span><span class="o">=</span><span class="n">mu_funcs</span><span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">],</span>
                     <span class="n">dataset</span><span class="o">=</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">],</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                     <span class="n">replNANs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">mobility</span> <span class="o">=</span> <span class="n">_griddata</span><span class="p">((</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]),</span> <span class="n">mu_func</span><span class="p">(</span><span class="n">dna_len</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">),</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replNANs</span> <span class="ow">and</span> <span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mobility</span><span class="p">):</span>
        <span class="c1"># Replace NANs by &#39;nearest&#39; interpolation</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: NAN replaced by &#39;nearest&#39; interpolation.&quot;</span><span class="p">)</span>  <span class="c1"># #### ! ###</span>
        <span class="n">mobility</span> <span class="o">=</span> <span class="n">_griddata</span><span class="p">((</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]),</span> <span class="n">mu_func</span><span class="p">(</span><span class="n">dna_len</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mobility</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">vWBRfit</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">DNAvals</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
            <span class="n">dataset</span><span class="o">=</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">],</span> <span class="n">mu_func</span><span class="o">=</span><span class="n">mu_funcs</span><span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">],</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">replNANs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">))</span>
    <span class="n">vWBR</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">,</span> <span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">muS</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">muL</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">muS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">gamma</span><span class="p">)))</span><span class="o">**-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Li</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_to_mobility</span><span class="p">(</span><span class="n">Li</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">mu_func</span><span class="p">,</span>
                                 <span class="n">dataset</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">vWBR</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">)</span>
    <span class="n">muS0</span> <span class="o">=</span> <span class="mf">3.5E-4</span>  <span class="c1"># cm^2/(V.sec)  ############################################</span>
    <span class="n">muL0</span> <span class="o">=</span> <span class="mf">1.0E-4</span>  <span class="c1"># cm^2/(V.sec)  ############################################</span>
    <span class="n">gamma0</span> <span class="o">=</span> <span class="mi">8000</span>  <span class="c1"># bp            ############################################</span>
    <span class="n">pars</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">_leastsq</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="p">[</span><span class="n">muS0</span><span class="p">,</span> <span class="n">muL0</span><span class="p">,</span> <span class="n">gamma0</span><span class="p">],</span>
                                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">,</span> <span class="n">mu</span><span class="p">),</span>
                                             <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">pars</span>
    <span class="c1"># print (&#39;E=%.2f V/cm, T=%.1f %%, muS=%.3e, muL=%.3e cm^2/(V.s), &#39;</span>
    <span class="c1">#        &#39;gamma=%s bp&#39; % (field, percentage, muS, muL, gamma))</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">DNAmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">)</span>
        <span class="n">DNAmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">,</span> <span class="n">mu</span><span class="o">*</span><span class="mf">1E4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">,</span> <span class="n">vWBR</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">,</span> <span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="mf">1E4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DNAmin</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">DNAmin</span><span class="p">,</span> <span class="n">DNAmax</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">DNAmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">*</span><span class="mf">1E4</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">*</span><span class="mf">1E4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathrm{DNA\,length\,(bp)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu\times{10^</span><span class="si">{8}</span><span class="s1">}\,(\mathrm{m^</span><span class="si">{2}</span><span class="s1">/V\cdot s})$&#39;</span><span class="p">,</span>
                      <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu_S=</span><span class="si">%.2e</span><span class="s1">,\,\mu_L=</span><span class="si">%.2e</span><span class="s1">\,\mathrm{cm^2/(V.s)},\,&#39;</span>
                     <span class="sa">r</span><span class="s1">&#39;\gamma=</span><span class="si">%d</span><span class="s1"> \mathrm</span><span class="si">{bp}</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pars</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span>


<div class="viewcode-block" id="ferguson_to_mu0"><a class="viewcode-back" href="../../index.html#pydna.gel.ferguson_to_mu0">[docs]</a><span class="k">def</span> <span class="nf">ferguson_to_mu0</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">Tvals</span><span class="p">,</span> <span class="n">DNAvals</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">mu_func</span><span class="p">,</span>
                    <span class="n">adjmethod</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">replNANs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extrapolates the free solution mobility (mu0)</span>
<span class="sd">    for a specified electric field intensity (field), via Ferguson plot</span>
<span class="sd">    (ln(mobility) vs. %agarose).</span>

<span class="sd">    Mobiliy calculation method:</span>
<span class="sd">    [E,T,muS,muL,gamma] -&gt; [E,T,mu(L)] -(L*)-&gt; [E,T,mu] -(E*,T*,interp.)-&gt; mu*</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Mobility dependence on size (mu(L)) for each agarose percentage (Ti)</span>
    <span class="n">ln_mu_LxT</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">Lj</span> <span class="ow">in</span> <span class="n">DNAvals</span><span class="p">:</span>
        <span class="n">ln_mu_T</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">Ti</span> <span class="ow">in</span> <span class="n">Tvals</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">size_to_mobility</span><span class="p">(</span><span class="n">Lj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">Ti</span><span class="p">,</span> <span class="n">mu_func</span><span class="p">,</span>
                                  <span class="n">dataset</span><span class="p">,</span> <span class="n">adjmethod</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">)</span>
            <span class="n">ln_mu_T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
        <span class="n">ln_mu_LxT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln_mu_T</span><span class="p">)</span>
    <span class="n">ln_mu_LxT</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ln_mu_LxT</span><span class="p">)</span>
    <span class="c1"># Linear regression for each DNA size</span>
    <span class="n">lregr_stats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">)):</span>
        <span class="n">not_nan</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ln_mu_LxT</span><span class="p">[</span><span class="n">l</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">not_nan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># (enough points for linear regression)</span>
            <span class="n">gradient</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span>\
                      <span class="n">_stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">Tvals</span><span class="p">[</span><span class="n">not_nan</span><span class="p">],</span> <span class="n">ln_mu_LxT</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">not_nan</span><span class="p">])</span>
            <span class="n">lregr_stats</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gradient</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span>
                                <span class="n">std_err</span><span class="p">))</span>
            <span class="n">exclude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exclude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
    <span class="n">DNAvals</span> <span class="o">=</span> <span class="n">DNAvals</span><span class="p">[</span><span class="o">~</span><span class="n">exclude</span><span class="p">]</span>
    <span class="n">ln_mu_LxT</span> <span class="o">=</span> <span class="n">ln_mu_LxT</span><span class="p">[</span><span class="o">~</span><span class="n">exclude</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lregr_stats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Free solution mobility determination</span>
        <span class="n">ln_mu0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lregr_stats</span><span class="p">])</span>  <span class="c1"># mean of intercepts</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_mu0</span><span class="p">)</span>  <span class="c1"># cm^2/(V.seg)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln_mu_LxT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Ferguson Plot (ln(mu) vs. %T) --&gt; mu0</span>
        <span class="n">regline</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span>  <span class="c1"># Line function (for the plot)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">_cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">)))</span>
        <span class="n">Tvals0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tvals</span><span class="p">])</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DNAvals</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Tvals</span><span class="p">,</span> <span class="n">ln_mu_LxT</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">DNAvals</span><span class="p">[</span><span class="n">l</span><span class="p">],</span>
                       <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">lregr_stats</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">lregr_stats</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tvals0</span><span class="p">,</span> <span class="p">[</span><span class="n">regline</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tvals0</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># ax.set_ylim(-10, -7.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm{DNA size (bp)}$&#39;</span><span class="p">,</span>
                  <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\%\,agarose$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathrm{ln(mobility\,[cm^</span><span class="si">{2}</span><span class="s1">/V sec])}$&#39;</span><span class="p">,</span>
                      <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathrm{Ferguson\,plot}$&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
                     <span class="sa">r</span><span class="s1">&#39;$\mathrm{ln(mobility)\,vs.\,\%\,agarose\,}$&#39;</span><span class="o">+</span>\
                     <span class="sa">r</span><span class="s1">&#39;$\mathrm{(field=</span><span class="si">%.3f</span><span class="s1">\,V/cm)}$&#39;</span> <span class="o">%</span><span class="n">field</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mu0</span>  <span class="c1"># cm^2/(V.seg)</span></div>


<div class="viewcode-block" id="gelplot_imshow"><a class="viewcode-back" href="../../index.html#pydna.gel.gelplot_imshow">[docs]</a><span class="k">def</span> <span class="nf">gelplot_imshow</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bandwidths</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">lanes</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span>
                   <span class="n">gel_len</span><span class="p">,</span> <span class="n">wellx</span><span class="p">,</span> <span class="n">welly</span><span class="p">,</span> <span class="n">wellsep</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">cursor_ovr</span><span class="p">,</span>
                   <span class="n">back_col</span><span class="p">,</span> <span class="n">band_col</span><span class="p">,</span> <span class="n">well_col</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">Itol</span><span class="p">,</span> <span class="n">detectlim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                   <span class="n">FWTM</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">nlanes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lanes</span><span class="p">)</span>
    <span class="n">gel_width</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wellx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nlanes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">wellsep</span>  <span class="c1"># cm</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;px/cm&#39;</span><span class="p">)</span>
    <span class="n">pxl_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">gel_width</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
    <span class="n">pxl_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">gel_len</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
    <span class="n">lane_centers</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">wellsep</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wellx</span><span class="p">[:</span><span class="n">l</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">wellx</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlanes</span><span class="p">)]</span>
    <span class="n">rgb_arr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">pxl_y</span><span class="p">,</span> <span class="n">pxl_x</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">bandlengths</span> <span class="o">=</span> <span class="n">wellx</span>
    <span class="n">bands_pxlXYmid</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Paint the bands</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlanes</span><span class="p">):</span>
        <span class="n">distXmid</span> <span class="o">=</span> <span class="n">lane_centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pxlXmid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">distXmid</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
        <span class="n">bandlength</span> <span class="o">=</span> <span class="n">bandlengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">from_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(((</span><span class="n">distXmid</span> <span class="o">-</span> <span class="n">bandlength</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
        <span class="n">to_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(((</span><span class="n">distXmid</span> <span class="o">+</span> <span class="n">bandlength</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
        <span class="n">bands_pxlXYmid</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lanes</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">distYmid</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">pxlYmid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">distYmid</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
            <span class="n">bands_pxlXYmid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pxlXmid</span><span class="p">,</span> <span class="n">pxlYmid</span><span class="p">))</span>
            <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bandwidths</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># w=FWHM or w=FWTM ???</span>
            <span class="k">if</span> <span class="n">FWTM</span><span class="p">:</span>
                <span class="n">FWHM</span> <span class="o">=</span> <span class="n">Gauss_FWHM</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FWHM</span> <span class="o">=</span> <span class="n">bandwidth</span>
            <span class="n">std_dev</span> <span class="o">=</span> <span class="n">Gauss_dev</span><span class="p">(</span><span class="n">FWHM</span><span class="p">)</span>
            <span class="n">maxI</span> <span class="o">=</span> <span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">midI</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">distYmid</span><span class="p">,</span> <span class="n">maxI</span><span class="p">,</span> <span class="n">distYmid</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pxlYmid</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb_arr</span><span class="p">):</span>  <span class="c1"># band within gel frontiers</span>
                <span class="n">rgb_arr</span><span class="p">[</span><span class="n">pxlYmid</span><span class="p">,</span> <span class="n">from_x</span><span class="p">:</span><span class="n">to_x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">midI</span>
            <span class="n">bckwdYstop</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">pxlYmid</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="n">forwdYstop</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">pxlYmid</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="n">pxlYbck</span> <span class="o">=</span> <span class="n">pxlYmid</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">pxlYfor</span> <span class="o">=</span> <span class="n">pxlYmid</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">bckwdYstop</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">forwdYstop</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">bckwdYstop</span><span class="p">:</span>
                    <span class="n">distYbck</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">pxlYbck</span><span class="p">,</span> <span class="s1">&#39;px&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">res</span>
                    <span class="n">bckYI</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">distYbck</span><span class="p">,</span> <span class="n">maxI</span><span class="p">,</span> <span class="n">distYmid</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pxlYbck</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb_arr</span><span class="p">):</span>
                        <span class="n">rgb_arr</span><span class="p">[</span><span class="n">pxlYbck</span><span class="p">,</span> <span class="n">from_x</span><span class="p">:</span><span class="n">to_x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">bckYI</span>
                    <span class="n">pxlYbck</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">bckYI</span> <span class="o">&lt;=</span> <span class="n">Itol</span> <span class="ow">or</span> <span class="n">pxlYbck</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">bckwdYstop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">forwdYstop</span><span class="p">:</span>
                    <span class="n">distYfor</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">pxlYfor</span><span class="p">,</span> <span class="s1">&#39;px&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">res</span>
                    <span class="n">forYI</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">distYfor</span><span class="p">,</span> <span class="n">maxI</span><span class="p">,</span> <span class="n">distYmid</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">)</span>
                    <span class="n">rgb_arr</span><span class="p">[</span><span class="n">pxlYfor</span><span class="p">,</span> <span class="n">from_x</span><span class="p">:</span><span class="n">to_x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">forYI</span>
                    <span class="n">pxlYfor</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">forYI</span> <span class="o">&lt;=</span> <span class="n">Itol</span> <span class="ow">or</span> <span class="n">pxlYfor</span> <span class="o">==</span> <span class="n">pxl_y</span><span class="p">:</span>
                        <span class="n">forwdYstop</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Background color</span>
    <span class="k">if</span> <span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">noise</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rgb_arr</span> <span class="o">+=</span> <span class="n">back_col</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bckg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">back_col</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span>
                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rgb_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">rgb_arr</span> <span class="o">+=</span> <span class="n">bckg</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">_np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="c1"># Saturation</span>
    <span class="n">rgb_arr</span><span class="p">[</span><span class="n">rgb_arr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">rgb_arr</span><span class="p">[</span><span class="n">rgb_arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># bands_arr = _np.ma.masked_where(rgb_arr == back_col, rgb_arr)  ###########</span>
    <span class="n">bands_arr</span> <span class="o">=</span> <span class="n">rgb_arr</span>
    <span class="c1"># Plot</span>
    <span class="n">gel_len</span> <span class="o">=</span> <span class="n">gel_len</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">gel_width</span> <span class="o">=</span> <span class="n">gel_width</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">wellx</span> <span class="o">=</span> <span class="n">wellx</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">welly</span> <span class="o">=</span> <span class="n">welly</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">wellsep</span> <span class="o">=</span> <span class="n">wellsep</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">lane_centers</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lane_centers</span><span class="p">]</span>
    <span class="n">bandlengths</span> <span class="o">=</span> <span class="n">bandlengths</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">bandwidths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bw</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">for</span> <span class="n">bw</span> <span class="ow">in</span> <span class="n">bwlane</span><span class="p">]</span> <span class="k">for</span> <span class="n">bwlane</span> <span class="ow">in</span> <span class="n">bandwidths</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">back_col</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;outward&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_bounds</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gel_len</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">back_col</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">back_col</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">lane_centers</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">majorLocator</span> <span class="o">=</span> <span class="n">_FixedLocator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">gel_len</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
    <span class="n">minorLocator</span> <span class="o">=</span> <span class="n">_FixedLocator</span><span class="p">([</span><span class="n">j</span><span class="o">/</span><span class="mf">10.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">gel_len</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">majorLocator</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">minorLocator</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># Gel image</span>
    <span class="n">bands_plt</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bands_arr</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">gel_width</span><span class="p">,</span> <span class="n">gel_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="c1"># Draw wells</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlanes</span><span class="p">):</span>
        <span class="n">ctr</span> <span class="o">=</span> <span class="n">lane_centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">wx</span> <span class="o">=</span> <span class="n">wellx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">wy</span> <span class="o">=</span> <span class="n">welly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">ctr</span><span class="o">-</span><span class="n">wx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">ctr</span><span class="o">+</span><span class="n">wx</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">y2</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">wy</span><span class="p">,</span> <span class="o">-</span><span class="n">wy</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">well_col</span><span class="p">))</span>
    <span class="c1"># Invisible rectangles overlapping the bands for datacursor to detect</span>
    <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlanes</span><span class="p">):</span>
        <span class="n">bandlength</span> <span class="o">=</span> <span class="n">bandlengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">lane_centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="n">bandlength</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lanes</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">dna_frag</span> <span class="o">=</span> <span class="n">lanes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bandwidths</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">-</span> <span class="n">bandwidth</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">pxlX</span><span class="p">,</span> <span class="n">pxlY</span> <span class="o">=</span> <span class="n">bands_pxlXYmid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">band_midI</span> <span class="o">=</span> <span class="n">bands_arr</span><span class="p">[</span><span class="n">pxlY</span><span class="p">,</span> <span class="n">pxlX</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">band_midI</span> <span class="o">-</span> <span class="n">back_col</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">detectlim</span> <span class="k">else</span> <span class="mf">0.4</span>
            <span class="n">band</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">bandlength</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span>
                                 <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> bp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dna_frag</span><span class="p">)))</span>
            <span class="n">_plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">gel_len</span><span class="p">,</span> <span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">welly</span><span class="p">))</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wellx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nlanes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">wellsep</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xlim</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Distance (cm)&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lanes&#39;</span><span class="p">)</span>
    <span class="n">bbox_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.6&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">an1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                       <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="p">(</span><span class="n">gel_len</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">welly</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span>
                       <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox_args</span><span class="p">)</span>
    <span class="n">an1</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">cursor_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span>
                       <span class="n">draggable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">hover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">),</span>
                       <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span>
                                       <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                       <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">),</span>
                       <span class="n">formatter</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{label}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor_ovr</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cursor_ovr</span><span class="p">:</span>
            <span class="n">cursor_args</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor_ovr</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cursor_args</span><span class="p">[</span><span class="s1">&#39;hover&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">cursor_args</span><span class="p">[</span><span class="s1">&#39;display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;single&#39;</span>
    <span class="c1"># _datacursor(bands, **cursor_args)</span>
    <span class="c1"># fig.savefig(&#39;example.png&#39;, dpi=300)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_plt</span></div>


<div class="viewcode-block" id="Gel"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel">[docs]</a><span class="k">class</span> <span class="nc">Gel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gel object for DNA slab-gel electrophoresis simulation.</span>

<span class="sd">    Class designed to store information regarding an electrophoresis</span>
<span class="sd">    experimental setup. Includes gel&#39;s and well&#39;s dimensions,</span>
<span class="sd">    DNA samples loaded, agarose concentration, electric field</span>
<span class="sd">    intensity and temperature.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    samples : list of lists of pydna.Dseqrecord objects</span>
<span class="sd">        List of samples with the DNA fragments to separate.</span>
<span class="sd">        Each sample corresponds to a different well.</span>
<span class="sd">        Accepts lists of pydna.Dseq objects and converts them to</span>
<span class="sd">        Dseqrecords with the default quantity (`n` parameter).</span>

<span class="sd">    names : list of str, optional</span>
<span class="sd">        List with the identifiers of the samples.</span>
<span class="sd">        Defaults to None, in which case the identifiers are of the form</span>
<span class="sd">        &quot;lane i&quot; where i is the index.</span>

<span class="sd">    percentgel : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Agarose concentration in the gel.</span>
<span class="sd">        Defaults to Q_(1.0, &#39;(g/(100 mL))*100&#39;).</span>
<span class="sd">        If a float or int is given assumes grams of agarose per milliliter</span>
<span class="sd">        of buffer.</span>

<span class="sd">    electrfield : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Electric field intensity.</span>
<span class="sd">        Defaults to Q_(5.0, &#39;V/cm&#39;).</span>
<span class="sd">        If a float or int is given assumes Volts per centimeter.</span>

<span class="sd">    temperature : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Absolute temperature.</span>
<span class="sd">        Defaults to Q_(295.15, &#39;K&#39;).</span>
<span class="sd">        If a float or int is given assumes Kelvin.</span>
<span class="sd">        The temperature is only considered in the calculation of the</span>
<span class="sd">        diffusional component of the band width.</span>

<span class="sd">    gel_len : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Gel length (as measured from the bottom of the well in the</span>
<span class="sd">        direction of the DNA migration).</span>
<span class="sd">        Defaults to Q_(8, &#39;cm&#39;).</span>
<span class="sd">        If a float or int is given assumes centimeters.</span>

<span class="sd">    wellxy : iterable of pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Well&#39;s dimensions.</span>
<span class="sd">        Well&#39;s width (perpendicular to the migration direction) and</span>
<span class="sd">        well&#39;s height (migration direction).</span>
<span class="sd">        Defaults to Q_([7, 2], &#39;mm&#39;).</span>
<span class="sd">        If a float or int is given assumes millimeters.</span>
<span class="sd">        The well&#39;s width is merely used for aesthetic purposes.</span>
<span class="sd">        The well&#39;s height is used to compute the initial band width.</span>

<span class="sd">    wellsep : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">        Separation between wells.</span>
<span class="sd">        Defaults to Q_(2, &#39;mm&#39;).</span>
<span class="sd">        Merelly for aestetic purposes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        * The DNA is diluted in the full volume of the well.</span>
<span class="sd">        * The previous implies that the injection size, which relates to</span>
<span class="sd">        the initial bandwidth, is assumed to be well height (welly).</span>
<span class="sd">        * The DNA electrophoretic mobility in the well is given by the free</span>
<span class="sd">        solution mobility and is equal for every fragment.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">samples</span><span class="p">,</span>                        <span class="c1"># list of lists of Dseqrecords</span>
                 <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">percentgel</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">),</span>  <span class="c1"># agar/buffer</span>
                 <span class="n">electrfield</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;V/cm&#39;</span><span class="p">),</span>
                 <span class="n">temperature</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">295.15</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">),</span>
                 <span class="n">gel_len</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">),</span>
                 <span class="n">wellxy</span><span class="o">=</span><span class="n">Q_</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;mm&#39;</span><span class="p">),</span>
                 <span class="n">wellsep</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">)</span>
                 <span class="p">):</span>
        <span class="c1">#self.samples = [[dna if isinstance(dna, Dseqrecord) else</span>
        <span class="c1">#                 Dseqrecord(dna) for dna in sample] for sample in</span>
        <span class="c1">#                samples]    # len(DNA) in bp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span> <span class="k">if</span> <span class="n">names</span> <span class="k">else</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>      <span class="c1">#</span>
                                          <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percent</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">percentgel</span><span class="p">,</span> <span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">,</span> <span class="s1">&#39;percentgel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">electrfield</span><span class="p">,</span> <span class="s1">&#39;V/cm&#39;</span><span class="p">,</span> <span class="s1">&#39;electrfield&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gel_len</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">gel_len</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">,</span> <span class="s1">&#39;gel_len&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wellx</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">wellxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;wellx&#39;</span><span class="p">)</span>  <span class="c1"># well width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">welly</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">wellxy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;welly&#39;</span><span class="p">)</span>  <span class="c1"># well height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wellsep</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">wellsep</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;wellsep&#39;</span><span class="p">)</span>
        <span class="c1"># Quantities</span>
        <span class="c1"># defaulQty = Q_(150,&#39;ng&#39;)</span>
        <span class="n">quantities</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Q_</span><span class="p">(</span><span class="n">dna</span><span class="o">.</span><span class="n">m</span><span class="p">(),</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dna</span> <span class="ow">in</span> <span class="n">sampl</span><span class="p">]</span> <span class="k">for</span> <span class="n">sampl</span> <span class="ow">in</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">,</span> <span class="s1">&#39;quantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>                                      <span class="c1"># ##########</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freesol_mob</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mobilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidths0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidthsI</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># exponential space of DNA sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_mu0</span> <span class="o">=</span> <span class="n">logspace_int</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_vWBRfit</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H2Oviscosity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_to_plateau</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equil_to_accel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zimm_to_Rouse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poresize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poresize_fit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_muS</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_muL</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_gamma</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Gel.set_field"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_field">[docs]</a>    <span class="k">def</span> <span class="nf">set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">electrfield</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">electrfield</span><span class="p">,</span> <span class="s1">&#39;V/cm&#39;</span><span class="p">,</span> <span class="s1">&#39;electrfield&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_percentgel"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_percentgel">[docs]</a>    <span class="k">def</span> <span class="nf">set_percentgel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentgel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percent</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">percentgel</span><span class="p">,</span> <span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">,</span> <span class="s1">&#39;percentgel&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_temperature"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">set_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_gelength"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_gelength">[docs]</a>    <span class="k">def</span> <span class="nf">set_gelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gel_len</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gel_len</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">gel_len</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">,</span> <span class="s1">&#39;gel_len&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_wellx"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_wellx">[docs]</a>    <span class="k">def</span> <span class="nf">set_wellx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wellx</span><span class="p">):</span>  <span class="c1"># set wellxy ???</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wellx</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">wellx</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;wellx&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_welly"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_welly">[docs]</a>    <span class="k">def</span> <span class="nf">set_welly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">welly</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">welly</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">welly</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;welly&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_wellsep"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_wellsep">[docs]</a>    <span class="k">def</span> <span class="nf">set_wellsep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wellsep</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wellsep</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">wellsep</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;wellsep&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_DNAspace_for_mu0"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_DNAspace_for_mu0">[docs]</a>    <span class="k">def</span> <span class="nf">set_DNAspace_for_mu0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DNA_space</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_mu0</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">DNA_space</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">,</span> <span class="s1">&#39;DNA_space&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_Tvals_for_mu0"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_Tvals_for_mu0">[docs]</a>    <span class="k">def</span> <span class="nf">set_Tvals_for_mu0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tvals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">Tvals</span><span class="p">,</span> <span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">,</span> <span class="s1">&#39;Tvals&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.set_DNAspace_for_vWBRfit"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.set_DNAspace_for_vWBRfit">[docs]</a>    <span class="k">def</span> <span class="nf">set_DNAspace_for_vWBRfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DNA_space</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_vWBRfit</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">DNA_space</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">,</span> <span class="s1">&#39;DNA_space&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gel.run"><a class="viewcode-back" href="../../index.html#pydna.gel.Gel.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">till_len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>         <span class="c1"># percent of gel_len</span>
            <span class="n">till_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>        <span class="c1"># hours</span>
            <span class="n">exposure</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>          <span class="c1"># [0-1]</span>
            <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">res</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;px/in&#39;</span><span class="p">),</span>
            <span class="n">cursor_ovr</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">hover</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">back_col</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">band_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">well_col</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">noise</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>
            <span class="n">detectlim</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span>
            <span class="n">interpol</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>     <span class="c1"># &#39;cubic&#39;,&#39;nearest&#39;</span>
            <span class="n">dset_name</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>  <span class="c1"># &#39;horizontal&#39;</span>
            <span class="n">replNANs</span><span class="o">=</span><span class="kc">True</span>          <span class="c1"># replace NANs by &#39;nearest&#39; interpolation</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run electrophoresis.</span>

<span class="sd">        Run the electrophoresis procedure until a specified time or until</span>
<span class="sd">        the quickest band reaches a specified gel length.</span>
<span class="sd">        If both conditions are given the most stringent will be respected.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        till_len : float (0 to 1), optional</span>
<span class="sd">            Fraction of the gel length (measured from the well bottom) to</span>
<span class="sd">            serve as finish line.</span>
<span class="sd">            Defaults to 0.75.</span>

<span class="sd">        till_time : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">            Time at which to stop the electrophoresis.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            If float or int is given assumes hours.</span>

<span class="sd">        exposure : float (0 to 1)</span>
<span class="sd">            Fraction of signal saturation.</span>
<span class="sd">            If exposure is set to 0 every band&#39;s light intensity will be</span>
<span class="sd">            given by a perfect Gaussian curve. Wider bands with lower</span>
<span class="sd">            amounts of DNA might be hard to see.</span>
<span class="sd">            The closer to 1 the exposure the higher the saturation, which</span>
<span class="sd">            favors the weaker bands visualization.</span>
<span class="sd">            If exposure is set to 1 only the weakest band will be a</span>
<span class="sd">            Gaussian, all others will be saturated.</span>
<span class="sd">            Defaults to 0.5.</span>

<span class="sd">        plot : {True, False}, optional</span>
<span class="sd">            Whether to draw and return the gel picture or not.</span>
<span class="sd">            The electrophoresis data (such as migrated distances) will be</span>
<span class="sd">            stored in the Gel object either way.</span>

<span class="sd">        res : pint.unit.Quantity object, float or int, optional</span>
<span class="sd">            Resolution used to construct an array of light intensities</span>
<span class="sd">            corresponding to the gel picture.</span>
<span class="sd">            The dimensions of the intensities array are given by the gel&#39;s</span>
<span class="sd">            dimensions multiplied by the resolution.</span>
<span class="sd">            A higher resolution implies more calculations and might cause</span>
<span class="sd">            the method to become slow.</span>
<span class="sd">            A lower resolution might result in a very pixelated image.</span>
<span class="sd">            Defaults to Q_(500, &#39;px/in&#39;).</span>
<span class="sd">            If float or int is given assumes pixels per inch.</span>
<span class="sd">            This resolution won&#39;t necessarily convey to the final gel</span>
<span class="sd">            picture since the intensity array is processed by</span>
<span class="sd">            matplotlib.pyplot.imshow.</span>

<span class="sd">        cursor_ovr : dict, optional</span>
<span class="sd">            Key arguments to be passed to mpldatacursor.datacursor which</span>
<span class="sd">            provides interactive cursor functions to the resulting plot.</span>
<span class="sd">            Defaults to dict(hover=False).</span>

<span class="sd">        back_col : float or int, optional</span>
<span class="sd">            Background color (light intensity).</span>
<span class="sd">            Defaults to 0.3.</span>
<span class="sd">            Solid black (0) allows the maximum contrast.</span>

<span class="sd">        band_col : float or int, optional</span>
<span class="sd">            Band color (maximum light intensity).</span>
<span class="sd">            Defaults to 1.</span>
<span class="sd">            White (1) allows for maximum contrast.</span>

<span class="sd">        well_col : float or int, optional</span>
<span class="sd">            Well color (light intensity).</span>
<span class="sd">            Defaults to 0.05.</span>

<span class="sd">        noise : float or int, optional</span>
<span class="sd">            Standard deviation used to generate a Normal distribution of</span>
<span class="sd">            noise centered in the background color. This effect is purely</span>
<span class="sd">            aesthetic.</span>
<span class="sd">            Defaults to 0.015.</span>

<span class="sd">        detectlim : float, optional</span>
<span class="sd">            Minimal light intensity difference between the center of the band</span>
<span class="sd">            and the background color (back_col) below which the band is</span>
<span class="sd">            considered to be indistinguishable and a white doted outline is</span>
<span class="sd">            drawn around it.</span>
<span class="sd">            Defaults to 0.04.</span>

<span class="sd">        interpol : {&#39;linear&#39;, &#39;cubic&#39;, &#39;nearest&#39;}, optional</span>
<span class="sd">            Interpolation method. This is passed to</span>
<span class="sd">            scipy.interpolate.griddata for the interpolation of the</span>
<span class="sd">            vWBR&#39;s parameters from the experimental datasets</span>
<span class="sd">            (mu_S, mu_L, gamma = f(field, agarose concentration) [1-3]_.</span>
<span class="sd">            Defaults to &#39;linear&#39; which is more conservative.</span>
<span class="sd">            &#39;nearest&#39; is not expected to provide good results.</span>

<span class="sd">        dset_name : {&#39;vertical&#39;, &#39;horizontal&#39;}, optional</span>
<span class="sd">            Dataset identifier (str). Identifies the dataset to use.</span>
<span class="sd">            Currently two datasets are available (&#39;vertical&#39; and</span>
<span class="sd">            &#39;horizontal&#39;) [1-3]_.</span>
<span class="sd">            The names alude to the geometry of the experimental setup.</span>
<span class="sd">            The geometry however is not expected to cause significant</span>
<span class="sd">            differences on the results.</span>

<span class="sd">        replNANs : {True, False}, optional</span>
<span class="sd">            Whether to replace NANs (not a number) by &#39;nearest&#39;</span>
<span class="sd">            interpolation. NANs will only be produced if the conditions</span>
<span class="sd">            of electric field intensity and agarose concentration go</span>
<span class="sd">            beyond the concave space provided by the dataset.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Van Winkle, D.H., Beheshti, A., Rill, R.L.: DNA</span>
<span class="sd">        electrophoresis in agarose gels: A simple relation describing the</span>
<span class="sd">        length dependence of mobility. ELECTROPHORESIS 23(1), 15‚Äì19 (2002)</span>

<span class="sd">        .. [2] Rill, R.L., Beheshti, A., Van Winkle, D.H.: DNA</span>
<span class="sd">        electrophoresis in agarose gels: Effects of field and gel</span>
<span class="sd">        concentration on the exponential dependence of reciprocal mobility</span>
<span class="sd">        on DNA length. ELECTROPHORESIS 23(16), 2710‚Äì2719 (2002)</span>

<span class="sd">        .. [3] Beheshti, A.: DNA Electrophoresis in th Agarose Gels: A New</span>
<span class="sd">        Mobility vs. DNA Length Dependence. Electronic Theses, Treatises and</span>
<span class="sd">        Dissertations (Paper 1207) (2002)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bandwidth</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># {0:&#39;well_only&#39;, 1:&#39;intrinsic_only&#39;, 2:&#39;both&#39;}</span>
        <span class="n">Itol</span> <span class="o">=</span> <span class="mf">1E-5</span>    <span class="c1"># intensity tolerance</span>
        <span class="n">FWTM</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># bandwidth interpreted as FWTM instead of FWHM</span>
        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>              <span class="c1"># V/cm</span>
        <span class="n">percentage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percent</span>       <span class="c1"># %agarose</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>  <span class="c1"># K</span>
        <span class="n">gel_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gel_len</span>          <span class="c1"># cm</span>
        <span class="n">wellx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wellx</span>              <span class="c1"># mm</span>
        <span class="n">welly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">welly</span>              <span class="c1"># mm</span>
        <span class="n">wellsep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wellsep</span>          <span class="c1"># mm</span>
        <span class="n">quantities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span>    <span class="c1"># ng</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">]</span>
        <span class="n">mu_func</span> <span class="o">=</span> <span class="n">mu_funcs</span><span class="p">[</span><span class="n">dset_name</span><span class="p">]</span>
        <span class="n">DNAspace_mu0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_mu0</span>
        <span class="n">DNAspace_vWBRfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNAspace_for_vWBRfit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]),</span>
                                    <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span><span class="p">,</span>
                                          <span class="s1">&#39;(g/(100 mL))*100&#39;</span><span class="p">,</span> <span class="s1">&#39;Tvals_for_mu0&#39;</span><span class="p">)</span>
        <span class="n">Tvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tvals_for_mu0</span>
        <span class="n">nlanes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lanes</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">exposure</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">exposure</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">exposure</span>  <span class="c1"># ##</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wellx</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">wellx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">wellx</span><span class="p">,</span> <span class="n">nlanes</span><span class="p">)</span>
        <span class="n">wellx</span> <span class="o">=</span> <span class="n">wellx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">welly</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">welly</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">welly</span><span class="p">,</span> <span class="n">nlanes</span><span class="p">)</span>
        <span class="n">welly</span> <span class="o">=</span> <span class="n">welly</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
        <span class="n">wellsep</span> <span class="o">=</span> <span class="n">wellsep</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
        <span class="n">till_len</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">till_len</span><span class="p">)</span> <span class="k">if</span> <span class="n">till_len</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">till_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">till_time</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">till_time</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;till_time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">to_units</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s1">&#39;px/cm&#39;</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">)</span>
        <span class="n">max_dist</span> <span class="o">=</span> <span class="n">till_len</span> <span class="o">*</span> <span class="n">gel_len</span>

        <span class="c1"># Electrophoretic Mobilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mobilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># # self.mobs=[]+append  ou self.mobs=None + assign</span>
            <span class="n">lane_mobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dna_frag</span> <span class="ow">in</span> <span class="n">lane</span><span class="p">:</span>
                <span class="n">dna_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dna_frag</span><span class="p">)</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>  <span class="c1"># bp assumption ###### ! ##</span>
                <span class="n">frag_mob</span> <span class="o">=</span> <span class="n">size_to_mobility</span><span class="p">(</span><span class="n">dna_size</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span>
                                            <span class="n">mu_func</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">interpol</span><span class="p">,</span>
                                            <span class="n">replNANs</span><span class="p">)</span>
                <span class="n">lane_mobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag_mob</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mobilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lane_mobs</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">))</span>  <span class="c1"># ##########</span>
        <span class="c1"># self.mobilities = Q_(self.mobilities, &#39;cm**2/V/s&#39;)</span>
        <span class="n">mobilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mobilities</span>
        <span class="n">max_mob</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">lane_mobs</span><span class="p">)</span> <span class="k">for</span> <span class="n">lane_mobs</span> <span class="ow">in</span> <span class="n">mobilities</span><span class="p">])</span>

        <span class="c1"># vWBR eq. parameters muL, muS, gamma</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">vWBRfit</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">DNAspace_vWBRfit</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">mu_func</span><span class="p">,</span>
                         <span class="n">interpol</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">muS</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">muS</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">muS</span><span class="p">,</span> <span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">)</span>                                            <span class="c1">#</span>
        <span class="n">muL</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">muL</span><span class="p">,</span> <span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">)</span>                                            <span class="c1">#</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">)</span>                                               <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_muS</span> <span class="o">=</span> <span class="n">muS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_muL</span> <span class="o">=</span> <span class="n">muL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vWBR_gamma</span> <span class="o">=</span> <span class="n">gamma</span>

        <span class="c1"># vWBR</span>
        <span class="c1"># mu_func = vWBR(muS, muL, gamma)</span>

        <span class="c1"># Time limit</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">runtime</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="n">max_mob</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>  <span class="c1"># sec</span>
        <span class="k">if</span> <span class="n">till_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">till_time</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">till_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">time</span>

        <span class="c1"># Distances</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">rundistance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">lane_mobs</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">lane_mobs</span> <span class="ow">in</span> <span class="n">mobilities</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span>

        <span class="c1"># Free solution mobility estimate</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="n">ferguson_to_mu0</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">Tvals</span><span class="p">,</span> <span class="n">DNAspace_mu0</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">mu_func</span><span class="p">,</span>
                              <span class="n">interpol</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">mu0</span><span class="p">,</span> <span class="s1">&#39;cm**2/V/s&#39;</span><span class="p">)</span>  <span class="c1"># #########################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freesol_mob</span> <span class="o">=</span> <span class="n">mu0</span>

        <span class="c1"># Initial bandwidths</span>
        <span class="n">dist0</span> <span class="o">=</span> <span class="n">welly</span>
        <span class="n">time0</span> <span class="o">=</span> <span class="n">dist0</span><span class="o">/</span><span class="p">(</span><span class="n">mu0</span><span class="o">*</span><span class="n">field</span><span class="p">)</span>
        <span class="n">bandwidths0</span> <span class="o">=</span> <span class="p">[</span><span class="n">mobs</span><span class="o">*</span><span class="n">time0</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">field</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">mobs</span> <span class="ow">in</span>
                       <span class="nb">enumerate</span><span class="p">(</span><span class="n">mobilities</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidths0</span> <span class="o">=</span> <span class="n">bandwidths0</span>

        <span class="c1"># Intrinsic diffusional bandwidths</span>
        <span class="n">muS</span> <span class="o">=</span> <span class="n">muS</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m**2/V/s&#39;</span><span class="p">)</span>
        <span class="n">muL</span> <span class="o">=</span> <span class="n">muL</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m**2/V/s&#39;</span><span class="p">)</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="n">mu0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m**2/V/s&#39;</span><span class="p">)</span>
        <span class="n">lp</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;lp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/bp&#39;</span><span class="p">)</span>
        <span class="n">kB</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;kB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m**2*kg/s**2/K&#39;</span><span class="p">)</span>
        <span class="n">qeff</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;qeff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;A*s/bp&#39;</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;V/m&#39;</span><span class="p">)</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">H2Oviscosity</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H2Oviscosity</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">pore_size</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a_fit</span> <span class="o">=</span> <span class="n">pore_size_fit</span><span class="p">(</span><span class="n">percentage</span><span class="p">)</span>  <span class="c1"># ##################################</span>
        <span class="n">a_fit</span> <span class="o">=</span> <span class="n">a_fit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>              <span class="c1"># ##################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poresize</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poresize_fit</span> <span class="o">=</span> <span class="n">a_fit</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">reduced_field</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
        <span class="n">Db</span> <span class="o">=</span> <span class="n">Dblob</span><span class="p">(</span><span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">N_lim1</span> <span class="o">=</span> <span class="n">accel_plateau</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>     <span class="c1"># #################################</span>
        <span class="n">N_lim2</span> <span class="o">=</span> <span class="n">equil_accel</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>       <span class="c1"># # ***   Major problem    ***   ##</span>
        <span class="n">N_lim3</span> <span class="o">=</span> <span class="n">Zimm_Rouse</span><span class="p">(</span><span class="n">Q_</span><span class="p">(</span><span class="mf">2E3</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">),</span>  <span class="c1"># #################################</span>
                            <span class="p">[</span><span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">lp</span><span class="p">])</span>
        <span class="c1"># print &#39;N_lim1 = accel_plateau = %s (%s)&#39; % (N_lim1,</span>
        <span class="c1">#                                             N_to_Nbp(N_lim1, a, b,</span>
        <span class="c1">#                                                      l))</span>
        <span class="c1"># print &#39;N_lim2 = equil_accel = %s (%s)&#39; %(N_lim2,</span>
        <span class="c1">#                                          N_to_Nbp(N_lim2, a, b, l))</span>
        <span class="c1"># print &#39;N_lim3 = Zimm_Rouse = %s (%s)&#39; %(N_lim3,</span>
        <span class="c1">#                                         N_to_Nbp(N_lim3, a, b, l))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_to_plateau</span> <span class="o">=</span> <span class="n">N_to_Nbp</span><span class="p">(</span><span class="n">N_lim1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equil_to_accel</span> <span class="o">=</span> <span class="n">N_to_Nbp</span><span class="p">(</span><span class="n">N_lim2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zimm_to_Rouse</span> <span class="o">=</span> <span class="n">N_to_Nbp</span><span class="p">(</span><span class="n">N_lim3</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>
            <span class="n">lane_widths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dna_frag</span> <span class="ow">in</span> <span class="n">lane</span><span class="p">:</span>
                <span class="n">Nbp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dna_frag</span><span class="p">)</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>  <span class="c1"># # assumption #################</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">Nbp_to_N</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="n">N_lim3</span><span class="p">:</span>
                    <span class="c1"># Ogston-Zimm</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">contour_length</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>   <span class="c1"># (m)</span>
                    <span class="n">Rg</span> <span class="o">=</span> <span class="n">radius_gyration</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span>  <span class="c1"># (m)</span>
                    <span class="n">D0</span> <span class="o">=</span> <span class="n">free_solution</span><span class="p">(</span><span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Rg</span><span class="p">)</span>  <span class="c1"># (m^2/s)</span>
                    <span class="n">DRouse</span> <span class="o">=</span> <span class="n">Ogston_Rouse</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span>
                                          <span class="n">a</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>  <span class="c1"># (m^2/s)</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">Zimm_g</span><span class="p">(</span><span class="n">Nbp</span><span class="p">,</span> <span class="n">DRouse</span><span class="p">,</span> <span class="n">qeff</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">kB</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>  <span class="c1"># base</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">Ogston_Zimm</span><span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>                               <span class="c1"># unit</span>
                <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="n">N_lim2</span><span class="p">:</span>
                    <span class="c1"># Rouse/Reptation-equilibrium</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">/</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">elif</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="n">N_lim1</span><span class="p">:</span>
                    <span class="c1"># Reptation-plateau (reptation with orientation)</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">*</span><span class="n">epsilon</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Accelerated-reptation</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">Db</span><span class="o">*</span><span class="n">epsilon</span><span class="o">*</span><span class="n">N</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">frag_width</span> <span class="o">=</span> <span class="n">bandbroadening</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
                <span class="n">lane_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bandwidthsI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lane_widths</span><span class="p">)</span>
        <span class="n">bandwidthsI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidthsI</span>

        <span class="c1"># Total bandwidths</span>
        <span class="n">bandwidths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bandwidths0</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">bandwidthsI</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>
                       <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lanes</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlanes</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidths</span> <span class="o">=</span> <span class="n">bandwidths</span>
        <span class="k">if</span> <span class="n">bandwidth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bandwidths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidths0</span>
        <span class="k">if</span> <span class="n">bandwidth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bandwidths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidthsI</span>

        <span class="c1"># Max intensities</span>
        <span class="n">raw_Is</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">maxI</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;ng/cm&#39;</span><span class="p">)</span>
        <span class="n">minI</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;ng/cm&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lane</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lanes</span><span class="p">):</span>
            <span class="n">lane_I</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lane</span><span class="p">)):</span>
                <span class="n">frag_Qty</span> <span class="o">=</span> <span class="n">quantities</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">frag_Wth</span> <span class="o">=</span> <span class="n">bandwidths</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># w=FWHM or w=FWTM ???</span>
                <span class="k">if</span> <span class="n">FWTM</span><span class="p">:</span>
                    <span class="n">FWHM</span> <span class="o">=</span> <span class="n">Gauss_FWHM</span><span class="p">(</span><span class="n">frag_Wth</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">FWHM</span> <span class="o">=</span> <span class="n">frag_Wth</span>
                <span class="n">std_dev</span> <span class="o">=</span> <span class="n">Gauss_dev</span><span class="p">(</span><span class="n">FWHM</span><span class="p">)</span>
                <span class="n">auc</span> <span class="o">=</span> <span class="n">frag_Qty</span>  <span class="c1"># area under curve proportional to DNA quantity</span>
                <span class="n">frag_I</span> <span class="o">=</span> <span class="n">Gauss_hgt</span><span class="p">(</span><span class="n">auc</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">)</span>  <span class="c1"># peak height</span>
                <span class="k">if</span> <span class="n">frag_I</span> <span class="o">&gt;</span> <span class="n">maxI</span><span class="p">:</span>
                    <span class="n">maxI</span> <span class="o">=</span> <span class="n">frag_I</span>
                <span class="k">if</span> <span class="n">frag_I</span> <span class="o">&lt;</span> <span class="n">minI</span><span class="p">:</span>
                    <span class="n">minI</span> <span class="o">=</span> <span class="n">frag_I</span>
                <span class="n">lane_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag_I</span><span class="p">)</span>
            <span class="n">raw_Is</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lane_I</span><span class="p">)</span>

        <span class="c1"># max intensity normalization</span>
        <span class="n">satI</span> <span class="o">=</span> <span class="n">maxI</span><span class="o">+</span><span class="n">exposure</span><span class="o">*</span><span class="p">(</span><span class="n">minI</span><span class="o">-</span><span class="n">maxI</span><span class="p">)</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">1</span><span class="o">-</span><span class="n">back_col</span><span class="p">)</span><span class="o">/</span><span class="n">satI</span><span class="o">*</span><span class="n">fragI</span> <span class="k">for</span> <span class="n">fragI</span> <span class="ow">in</span> <span class="n">lane</span><span class="p">]</span>
                       <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">raw_Is</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="n">intensities</span>

        <span class="c1"># Plot gel</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># Title</span>
            <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># time is in secs</span>
            <span class="n">hours</span><span class="p">,</span> <span class="n">mins</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">mins</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">hours</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">)</span>
            <span class="n">mins</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">mins</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>
            <span class="n">secs</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">secs</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.2f</span><span class="s1"> V/cm</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;C = </span><span class="si">%.1f</span><span class="s1"> </span><span class="si">%%</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;T = </span><span class="si">%.2f</span><span class="s1"> K</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;t = </span><span class="si">%d</span><span class="s1"> h </span><span class="si">%02d</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;expo = </span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;V/cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                      <span class="n">percentage</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                      <span class="n">temperature</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                      <span class="n">hours</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">mins</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                      <span class="n">exposure</span><span class="p">))</span>
            <span class="c1"># Plot</span>
            <span class="n">gelpic</span> <span class="o">=</span> <span class="n">gelplot_imshow</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bandwidths</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">lanes</span><span class="p">,</span>
                                    <span class="n">names</span><span class="p">,</span> <span class="n">gel_len</span><span class="p">,</span> <span class="n">wellx</span><span class="p">,</span> <span class="n">welly</span><span class="p">,</span> <span class="n">wellsep</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span>
                                    <span class="n">cursor_ovr</span><span class="p">,</span> <span class="n">back_col</span><span class="p">,</span> <span class="n">band_col</span><span class="p">,</span> <span class="n">well_col</span><span class="p">,</span>
                                    <span class="n">noise</span><span class="p">,</span> <span class="n">Itol</span><span class="p">,</span> <span class="n">detectlim</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">FWTM</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="c1">#gelpic</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_gel</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">test_mu0</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">test_vWBRfit</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">test_vWBRfit_comprehensive</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># very time consuming</span>
    <span class="n">check_ladders</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Conditions</span>
    <span class="n">electrfield</span> <span class="o">=</span> <span class="mf">6.21</span>    <span class="c1"># V/cm</span>
    <span class="n">percentgel</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># %agarose</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="mf">295.15</span>  <span class="c1"># K</span>

    <span class="c1"># Gel length and geometry</span>
    <span class="n">gel_len</span> <span class="o">=</span> <span class="mf">7.5</span>  <span class="c1"># cm</span>

    <span class="c1"># Well dimensions</span>
    <span class="n">wellx</span> <span class="o">=</span> <span class="mi">7</span>    <span class="c1"># mm</span>
    <span class="n">welly</span> <span class="o">=</span> <span class="mi">2</span>    <span class="c1"># mm</span>
    <span class="n">wellsep</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># mm</span>

    <span class="c1"># Length limit</span>
    <span class="n">till_len</span> <span class="o">=</span> <span class="mf">0.77</span>

    <span class="c1"># Time limit</span>
    <span class="n">till_time</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># 45/60.0</span>

    <span class="c1"># Exposure factor</span>
    <span class="n">exposure</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="c1"># Dataset and interpolation</span>
    <span class="n">dset_name</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">]</span>
    <span class="n">interpol</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="n">replNANs</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Plot</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;px/in&#39;</span><span class="p">)</span>
    <span class="n">cursor_ovr</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># dict(hover=True)</span>
    <span class="n">back_col</span> <span class="o">=</span> <span class="mf">0.33166993353685043</span>  <span class="c1"># 0.332  0.15</span>
    <span class="n">band_col</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">well_col</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="mf">0.023400015217741609</span>  <span class="c1"># 0.015</span>
    <span class="n">detectlim</span> <span class="o">=</span> <span class="mf">0.04</span>

    <span class="c1"># Lane identifiers</span>
    <span class="n">lanenames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">]</span>

    <span class="c1"># Samples</span>
    <span class="n">ladder</span> <span class="o">=</span> <span class="n">weight_standard_sample</span><span class="p">(</span><span class="s1">&#39;1kb_GeneRuler&#39;</span><span class="p">)</span>
    <span class="n">sample1</span> <span class="o">=</span> <span class="n">gen_sample</span><span class="p">([</span><span class="mi">561</span><span class="p">,</span> <span class="mi">1302</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">5021</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.82</span><span class="p">,</span> <span class="mf">18.15</span><span class="p">,</span> <span class="mf">1.88</span><span class="p">,</span> <span class="mf">70.00</span><span class="p">])</span>
    <span class="n">sample2</span> <span class="o">=</span> <span class="n">gen_sample</span><span class="p">([</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span> <span class="p">[</span><span class="mf">70.00</span><span class="p">,</span> <span class="mf">11.67</span><span class="p">,</span> <span class="mf">35.00</span><span class="p">])</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">ladder</span><span class="p">,</span> <span class="n">sample1</span><span class="p">,</span> <span class="n">sample2</span><span class="p">]</span>

    <span class="c1"># Quantities</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># quantities.append([25, 25, 25, 60, 25, 25, 25, 70, 30, 30, 30, 70, 30,</span>
    <span class="c1">#                    30])</span>
    <span class="c1"># quantities.append([50]*4)</span>
    <span class="c1"># quantities.append([])</span>
    <span class="c1"># quantities.append(100)</span>
    <span class="c1"># quantities.append([120, 20, 60])</span>
    <span class="c1"># quantities = None</span>

    <span class="c1"># Data</span>
    <span class="c1"># DNAmin = 100</span>
    <span class="c1"># DNAmax = 20000</span>
    <span class="c1"># DNAdivs = 100</span>
    <span class="n">DNAvals</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>
    <span class="n">DNAspace</span> <span class="o">=</span> <span class="n">logspace_int</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">bp</span>
    <span class="n">divsE</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">divsT</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Evals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">][</span><span class="s1">&#39;E&#39;</span><span class="p">])))</span>  <span class="c1"># why sort and list?</span>
    <span class="n">minE</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Evals</span><span class="p">)</span>
    <span class="n">maxE</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Evals</span><span class="p">)</span>
    <span class="n">E_space</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minE</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">maxE</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">divsE</span><span class="p">))</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">minE</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
    <span class="n">Tvals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">])))</span>
    <span class="n">minT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Tvals</span><span class="p">)</span>
    <span class="n">maxT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Tvals</span><span class="p">)</span>
    <span class="n">T_space</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minT</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">maxT</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">divsT</span><span class="p">))</span> <span class="o">*</span> <span class="n">ureg</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">minT</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">test_gel</span><span class="p">:</span>
        <span class="c1"># ### Instantiate Gel ###</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Gel</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">lanenames</span><span class="p">,</span> <span class="n">percentgel</span><span class="p">,</span> <span class="n">electrfield</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span>
                <span class="n">gel_len</span><span class="p">,</span> <span class="p">(</span><span class="n">wellx</span><span class="p">,</span> <span class="n">welly</span><span class="p">),</span> <span class="n">wellsep</span><span class="p">)</span>

        <span class="c1"># ### Run Gel ###</span>
        <span class="n">pic</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">till_len</span><span class="p">,</span> <span class="n">till_time</span><span class="p">,</span> <span class="n">exposure</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span>
                    <span class="n">cursor_ovr</span><span class="p">,</span> <span class="n">back_col</span><span class="p">,</span> <span class="n">band_col</span><span class="p">,</span> <span class="n">well_col</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">detectlim</span><span class="p">,</span>
                    <span class="n">interpol</span><span class="p">,</span> <span class="n">dset_name</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># pic.savefig(&#39;gelplot.jpg&#39;, dpi=300)</span>
            <span class="c1"># pic.show()</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">test_mu0</span><span class="p">:</span>
        <span class="c1"># ### Test &lt;ferguson_to_mu0&gt; ### --------------------------------------</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;( Free Solution Mobility from Ferguson Plot )&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">Ei</span> <span class="ow">in</span> <span class="n">E_space</span><span class="p">:</span>
            <span class="n">mu0</span> <span class="o">=</span> <span class="n">ferguson_to_mu0</span><span class="p">(</span><span class="n">Ei</span><span class="p">,</span> <span class="n">T_space</span><span class="p">,</span> <span class="n">DNAspace</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span>
                                  <span class="n">mu_funcs</span><span class="p">[</span><span class="n">dset_name</span><span class="p">],</span> <span class="n">interpol</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">,</span>
                                  <span class="n">plot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mu0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">mu0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mu0= </span><span class="si">%.3e</span><span class="s1"> cm^2/(V.seg)&#39;</span> <span class="o">%</span> <span class="n">mu0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test_vWBRfit</span><span class="p">:</span>
        <span class="c1"># ### Test &lt;vWBRfit&gt; ### ----------------------------------------------</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;( Non-linear Least Squares Fitting&quot;</span>
               <span class="s2">&quot; with vWBR&#39;s Eq. )&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">vWBRfit</span><span class="p">(</span><span class="n">electrfield</span><span class="p">,</span> <span class="n">percentgel</span><span class="p">,</span> <span class="n">DNAvals</span><span class="p">,</span>
                         <span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">],</span> <span class="n">mu_funcs</span><span class="p">[</span><span class="n">dset_name</span><span class="p">],</span>
                         <span class="n">interpol</span><span class="p">,</span> <span class="n">replNANs</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="c1"># print output</span>

    <span class="k">if</span> <span class="n">test_vWBRfit_comprehensive</span><span class="p">:</span>
        <span class="c1"># ### Test &lt;vWBRfit comprehensively&gt; ### ------------------------------</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;( Non-linear Least Squares Fitting with vWBR&#39;s Eq.&quot;</span>
               <span class="s2">&quot;- comprehensive )&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">Ei</span> <span class="ow">in</span> <span class="n">E_space</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">Ti</span> <span class="ow">in</span> <span class="n">T_space</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">vWBRfit</span><span class="p">(</span><span class="n">Ei</span><span class="p">,</span> <span class="n">Ti</span><span class="p">,</span> <span class="n">DNAvals</span><span class="p">,</span>
                                 <span class="n">dataset</span><span class="o">=</span><span class="n">datasets</span><span class="p">[</span><span class="n">dset_name</span><span class="p">],</span>
                                 <span class="n">mu_func</span><span class="o">=</span><span class="n">mu_funcs</span><span class="p">[</span><span class="n">dset_name</span><span class="p">],</span>
                                 <span class="n">method</span><span class="o">=</span><span class="n">interpol</span><span class="p">,</span> <span class="n">replNANs</span><span class="o">=</span><span class="n">replNANs</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_ladders</span><span class="p">:</span>
        <span class="c1"># ### Verify and print weight_standards info ### ----------------------</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;( DNA Ladder Info )&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">store_n</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">store_m</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">weight_standards</span><span class="p">:</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="n">weight_standards</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;sizes&#39;</span><span class="p">]</span>
            <span class="n">fracs</span> <span class="o">=</span> <span class="n">weight_standards</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;ug&#39;</span><span class="p">)</span>
            <span class="n">masses</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="n">fracs</span>
            <span class="n">ladder</span> <span class="o">=</span> <span class="n">weight_standard_sample</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
            <span class="n">ns</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="n">seqrec</span><span class="o">.</span><span class="n">n</span> <span class="k">for</span> <span class="n">seqrec</span> <span class="ow">in</span> <span class="n">ladder</span><span class="p">],</span> <span class="s1">&#39;mol&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;pmol&#39;</span><span class="p">)</span>
            <span class="p">[</span><span class="n">store_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;pmol&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">]</span>
            <span class="p">[</span><span class="n">store_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masses</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">fracs</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ladder: </span><span class="si">%s</span><span class="s1">, len(sizes)&#39;</span>
                                              <span class="s1">&#39; != len(percent)&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">fracs</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ladder: </span><span class="si">%s</span><span class="s1">, sum(percent)&#39;</span>
                                               <span class="s1">&#39; != 1&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;size </span><span class="se">\t\t</span><span class="s1"> mass/</span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> fraction </span><span class="se">\t</span><span class="s1"> n/pmol&#39;</span> <span class="o">%</span> <span class="n">total</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sizes</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">   </span><span class="se">\t</span><span class="s1">  </span><span class="si">%.3f</span><span class="s1">  </span><span class="se">\t</span><span class="s1">  </span><span class="si">%.3f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                           <span class="n">masses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                                           <span class="n">fracs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                                                           <span class="n">ns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;min(m) = </span><span class="si">%.4f</span><span class="s2"> ng&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">store_m</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avg(m) = </span><span class="si">%.4f</span><span class="s2"> ng&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">store_m</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max(m) = </span><span class="si">%.4f</span><span class="s2"> ng&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">store_m</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;min(n) = </span><span class="si">%.4f</span><span class="s2"> pmol&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">store_n</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avg(n) = </span><span class="si">%.4f</span><span class="s2"> pmol&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">store_n</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max(n) = </span><span class="si">%.4f</span><span class="s2"> pmol&quot;</span> <span class="o">%</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">store_n</span><span class="p">))</span>


<span class="c1"># References (very incomplete)</span>
<span class="c1"># ============================================================================#</span>
<span class="c1"># 1. Van Winkle, D.H., Beheshti, A., Rill, R.L.: DNA electrophoresis in       #</span>
<span class="c1"># agarose gels: A simple relation describing the length dependence of         #</span>
<span class="c1"># mobility. ELECTROPHORESIS 23(1), 15‚Äì19 (2002)                               #</span>
<span class="c1">#                                                                             #</span>
<span class="c1"># 2. Rill, R.L., Beheshti, A., Van Winkle, D.H.: DNA electrophoresis in       #</span>
<span class="c1"># agarose gels: Effects of field and gel concentration on the exponential     #</span>
<span class="c1"># dependence of reciprocal mobility on DNA length. ELECTROPHORESIS 23(16),    #</span>
<span class="c1"># 2710‚Äì2719 (2002)                                                            #</span>
<span class="c1">#                                                                             #</span>
<span class="c1"># 3. Beheshti, A.: DNA Electrophoresis in th Agarose Gels: A New Mobility vs. #</span>
<span class="c1"># DNA Length Dependence. Electronic Theses, Treatises and Dissertations       #</span>
<span class="c1"># (Paper 1207)(2002)                                                          #</span>
<span class="c1"># ============================================================================#</span>

<span class="c1"># Bugs</span>
<span class="c1"># ============================================================================#</span>
<span class="c1"># - Error when zooming and hovering cursor.                                   #</span>
<span class="c1"># - Imperfect conversion from array to image!?                                #</span>
<span class="c1">#   While in the array the band broadness didn&#39;t vary more than one &quot;pixel&quot;,  #</span>
<span class="c1">#   in the plot the difference was greater and more  noticeable.              #</span>
<span class="c1">#       ? imshow options ?                                                    #</span>
<span class="c1">#       ? Resolution ?                                                        #</span>
<span class="c1">#       ? Only in &quot;show&quot; not in &quot;save&quot; ?                                      #</span>
<span class="c1">#       ? Interference of other plot parameters ?                             #</span>
<span class="c1"># - The hoovering mode of the datacursor is slow.                             #</span>
<span class="c1"># - Error when till_length is 1: IndexError: index 3150 is out of bounds for  #</span>
<span class="c1">#   axis 0 with size 3150                                                     #</span>
<span class="c1"># ============================================================================#</span>

<span class="c1"># Questions for Professor Bj√∂rn</span>
<span class="c1"># ============================================================================#</span>
<span class="c1"># - Ask for guidance for the simple SAMPLE objects and basic operations.      #</span>
<span class="c1"># - Ask for guidance for the default values.                                  #</span>
<span class="c1"># - Ask for guidance for the user friendliness from the standpoint of a       #</span>
<span class="c1">#   researcher.                                                               #</span>
<span class="c1"># - Would an &quot;excise band&quot; method be useful?                                  #</span>
<span class="c1"># ============================================================================#</span>

<span class="c1"># To-do list</span>
<span class="c1"># ============================================================================#</span>
<span class="c1"># - Band convolution (https://en.wikipedia.org/wiki/Convolution);             #</span>
<span class="c1"># - Qualitative and quantitative validation;                                  #</span>
<span class="c1"># - Comparison with other softwares;                                          #</span>
<span class="c1"># - Gather more data (obtained at well controlled conditions);                #</span>
<span class="c1">#       + Professor Beheshti&#39;s Phd thesis                                     #</span>
<span class="c1">#       + Extend the dataset with new experimental data                       #</span>
<span class="c1"># - Study extrapolation options beyond the data range:                        #</span>
<span class="c1">#       + parameters dependence on gel concentration equations (at low field) #</span>
<span class="c1"># - Train and validate a regression predictive model;                         #</span>
<span class="c1"># - Interpolation of user&#39;s experimental data with vWBR equation;             #</span>
<span class="c1"># ----------------------------------------------------------------------------#</span>
<span class="c1"># - Documentation (Numpy style);                                              #</span>
<span class="c1"># - Code readability and conformity to standards and style guides;            #</span>
<span class="c1"># - User friendliness;                                                        #</span>
<span class="c1"># - Testing module;                                                           #</span>
<span class="c1"># - Sharing on GitHub;                                                        #</span>
<span class="c1"># - Integration with pydna;                                                   #</span>
<span class="c1"># - Application exemples and guide in IPython Notebook;                       #</span>
<span class="c1"># - &lt;mu_func&gt; as module variable??                                            #</span>
<span class="c1"># - self.runtime = _np.nan??                                                   #</span>
<span class="c1"># - Data and mu_funcs as module variables or class variables??                #</span>
<span class="c1"># - Keep most values in numpy arrays?? (may be helpful to implement units)    #</span>
<span class="c1"># - Experimental conditions on the plot&#39;s title;                              #</span>
<span class="c1"># - Keep and return the plots objects;                                        #</span>
<span class="c1"># - Passing the matplotlib&#39;s **keyargs;                                       #</span>
<span class="c1"># - Additional plots;                                                         #</span>
<span class="c1"># - Variable mapping:                                                         #</span>
<span class="c1">#       {&#39;var&#39;:&#39;meaning&#39;}{&#39;var&#39;:&#39;units&#39;}                                      #</span>
<span class="c1">#       {&#39;E&#39;:&#39;Electric field intensity (V/cm)&#39;, ...}                          #</span>
<span class="c1"># - Internal objects to organize information (LANE, BAND, SAMPLE);            #</span>
<span class="c1"># - Recognize unequivocal initials: &#39;v&#39;:&#39;vertical&#39;, &#39;h&#39;:&#39;horizontal&#39;, etc.;   #</span>
<span class="c1"># - There should be a single (Pint) UnitRegistry for the entire project.      #</span>
<span class="c1"># - Show DNA size in matplotlib coordinate viewer:                            #</span>
<span class="c1">#       &quot;http://stackoverflow.com/questions/14754931/matplotlib-values-under- #</span>
<span class="c1">#        cursor&quot;                                                              #</span>
<span class="c1"># - Click band to print DNA fragment data in console;                         #</span>
<span class="c1"># - Defaults, Assertions, warnings, errors, etc.                              #</span>
<span class="c1"># - Assert dimension concordance:                                             #</span>
<span class="c1">#       if wellx is iterable: len(wellx) == len(lanes)                        #</span>
<span class="c1"># - Combine gels;                                                             #</span>
<span class="c1"># - Mosaic of gels: same samples, different conditions;                       #</span>
<span class="c1"># - Method &lt;save_with_resolution&gt;;                                            #</span>
<span class="c1"># - Attention to pixel [0], in pixel-&gt;cm / cm-&gt;pixel conversions;             #</span>
<span class="c1"># - Study more carefully the distance &lt;-&gt; pixel conversion;                   #</span>
<span class="c1"># - At this point, the &quot;exposure time&quot; is being optimized so that no band&#39;s   #</span>
<span class="c1">#   intensity saturates (reaches white color) before it&#39;s peak. All curves    #</span>
<span class="c1">#   are perfect Gaussians. This benefites the highest curves in detriment of  #</span>
<span class="c1">#   the wider ones. It may be better for visualization to allow saturation    #</span>
<span class="c1">#   basing the &quot;exposure time&quot; on a parameter, maximizing the average hight   #</span>
<span class="c1">#   band or assuring that no peak falls bellow a certain level.               #</span>
<span class="c1"># - There is pehaps a wiser way to perform peak convolution.                  #</span>
<span class="c1"># - The stoping condition for the evaluation of the intensity function is too #</span>
<span class="c1">#   strick. &quot;color &lt;= background&quot; goes till the order of 1E-16. A toletance   #</span>
<span class="c1">#   is needed.                                                                #</span>
<span class="c1"># - Peak convolution in the perpendicular direction.                          #</span>
<span class="c1"># - premade Ladder addition.                                                  #</span>
<span class="c1"># - Dimension concordance, data type and missing values verification on input.#</span>
<span class="c1"># - Full spell check.                                                         #</span>
<span class="c1"># - Most assert statements must be replaced with proper errors.               #</span>
<span class="c1"># ============================================================================#</span>

<span class="c1"># Random notes</span>
<span class="c1"># ============================================================================#</span>
<span class="c1"># - Avoid integer division: from __future__ import division                   #</span>
<span class="c1"># - Careful: Operations with unitary numpy arrays return numeric data types:  #</span>
<span class="c1">#       + type(_np.array(2)*_np.array(2)) --&gt; &lt;&#39;numpy.int32&#39;&gt;                   #</span>
<span class="c1">#       + type(_np.array(2)*_np.array(2)/_np.array(5)) --&gt; &lt;&#39;numpy.int32&#39;&gt;       #</span>
<span class="c1">#       + from __future__ import division                                     #</span>
<span class="c1">#         type(_np.array(2)*_np.array(2)/_np.array(5)) --&gt; &lt;&#39;numpy.float64&#39;&gt;     #</span>
<span class="c1">#       + _np.asarray(_np.array(2)*_np.array(2)/_np.array(5)) --&gt; array(0.8)      #</span>
<span class="c1"># - The pore size in the diffusion coefficient equations might not be an      #</span>
<span class="c1">#   &quot;effective&quot; pore size as that defined by Slater as function of muL, mu0   #</span>
<span class="c1">#   and gamma. Note that Viovy defined the interval 200-500 nm as the         #</span>
<span class="c1">#   consensus regarding pore size in 1% agarose gel. Yet, using Slater&#39;s      #</span>
<span class="c1">#   method we arrive at an effective pore size of 135.4 nm.                   #</span>
<span class="c1"># - I&#39;m getting a smaller free solution mobility than the muS parameter.      #</span>
<span class="c1">#   I think it should be the other way around!...                             #</span>
<span class="c1"># - Is it better to never have unused lanes (as it is now) or to build a gel  #</span>
<span class="c1">#   with a chosen dimension and number of wells (used or not)?                #</span>
<span class="c1"># - The one thing that causes troubles with quantities is to assign a         #</span>
<span class="c1">#   quantity to a list of quantities. Ex: Q_([Q_(1, &#39;nm&#39;)], &#39;nm&#39;)             #</span>
<span class="c1">#   With that in mind, there might be simpler ways to implement the           #</span>
<span class="c1">#   functionality of &quot;to_units&quot;.                                              #</span>
<span class="c1"># - mpldatacursor use:                                                        #</span>
<span class="c1">#       + right-click on annotation box to hide it;                           #</span>
<span class="c1">#       + press &quot;d&quot; on the keyboard to hide all annotation boxes;             #</span>
<span class="c1">#       + press &quot;t&quot; (toogle) to disable or re-enable interactive datacursors. #</span>
<span class="c1"># ============================================================================#</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Pydna 3.0.1+2.g47ae1f65a3.dirty documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../pydna.html" >pydna</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2019, Bj√∂rn Johansson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>